 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IXORIUM </title>
  <!-- React & ReactDOM (CDN) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel for JSX transpiling in browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- solana/web3.js -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
  <!-- solana/spl-token -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.3.5/lib/index.iife.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      max-width: 480px;
      margin: 30px auto;
      font-size: 14px;
      background: #f9f9f9;
      color: #222;
      padding: 0 15px 50px 15px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    h2 {
      font-weight: 600;
      text-align: center;
      margin-bottom: 25px;
      font-size: 1.4rem;
    }
    button {
      cursor: pointer;
      background-color: #007aff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 0.9rem;
      padding: 8px 16px;
      transition: background-color 0.3s ease;
    }
    button:hover:not([disabled]){
      background-color: #005ecb;
    }
    button[disabled] {
      background-color: #a0a0a0;
      cursor: not-allowed;
    }
    fieldset {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin-top: 12px;
      background: white;
    }
    legend {
      font-weight: 700;
      font-size: 1.1rem;
      padding: 0 8px;
    }
    label {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 4px;
      display: block;
    }
    select, input[type=number] {
      width: 100%;
      padding: 6px 8px;
      font-size: 0.9rem;
      border: 1px solid #bbb;
      border-radius: 5px;
      box-sizing: border-box;
      margin-top: 4px;
      margin-bottom: 6px;
      transition: border-color 0.2s ease;
    }
    select:focus, input[type=number]:focus {
      outline: none;
      border-color: #007aff;
      box-shadow: 0 0 3px #007aff66;
    }
    small {
      color: #555;
      display: block;
      margin-top: -4px;
      margin-bottom: 12px;
      font-size: 0.75rem;
    }
    .btn-swap {
      margin: 10px auto;
      display: block;
      font-weight: 600;
      font-size: 1rem;
    }
    .route-box {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      background: white;
      transition: border-color 0.25s ease, background-color 0.25s ease;
      user-select: none;
    }
    .route-box:hover {
      border-color: #007aff;
      background-color: #f0f8ff;
    }
    .route-box.selected {
      border-color: #007aff;
      background-color: #e2f0ff;
    }
    p.status {
      margin-top: 20px;
      word-wrap: break-word;
      font-size: 0.85rem;
      color: #005ecb;
      font-weight: 600;
    }
    footer {
      margin-top: 40px;
      font-size: 0.75rem;
      color: #666;
      text-align: center;
      user-select:none;
    }
    a {
      color: #007aff;
      text-decoration: underline;
    }
    .token-logo {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      margin-right: 4px;
      vertical-align: middle;
      background: #fff;
      border: 1px solid #eee;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">

    const {
      useState,
      useEffect,
      useCallback,
      StrictMode,
    } = React;

    const {
      Connection,
      PublicKey,
      clusterApiUrl,
      Transaction,
    } = solanaWeb3;

    const SOL_MINT = 'So11111111111111111111111111111111111111112';
    const JUPITER_API_BASE = 'https://quote-api.jup.ag/v6';

    const tokensList = [
      {
        address: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
        symbol: 'USDC',
        name: 'USD Coin',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png',
      },
   {
    address:'H4qKn8FMFha8jJuj8xMryMqRhH3h7GjLuxw7TVixpump'
     symbol: 'FIXERCOIN ',
   name:'FIXERCOIN',
   decimals:6,
     logoURI:'',
     },
     {
        address: 'Es9vMFrzaCER7N1TvjVqauDziYbPEmxW5M9VpX1TTd8C',
        symbol: 'USDT',
        name: 'Tether USD',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/Es9vMFrzaCER7N1TvjVqauDziYbPEmxW5M9VpX1TTd8C/logo.png',
      },
      {
        address: 'SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt',
        symbol: 'SRM',
        name: 'Serum',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt/logo.png',
      },
      {
        address: '4k3Dyjzvzp8e4wJ7TGLkpvJ7YenqR6AMx7jxUnnGghPf',
        symbol: 'RAY',
        name: 'Raydium',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/4k3Dyjzvzp8e4wJ7TGLkpvJ7YenqR6AMx7jxUnnGghPf/logo.png',
      },
      {
        address: 'orcaE6ZxFtoajT2zF3ahNHPs2bWkm8c5KxjxHPv3RRZ4',
        symbol: 'ORCA',
        name: 'Orca',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/orcaE6ZxFtoajT2zF3ahNHPs2bWkm8c5KxjxHPv3RRZ4/logo.png',
      },
      {
        address: 'FTTGFt2jEQq3RpAm3qNihC84sFD3AYwhzMTeKuFzQZ9',
        symbol: 'FTT',
        name: 'FTT Token',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/FTTGFt2jEQq3RpAm3qNihC84sFD3AYwhzMTeKuFzQZ9/logo.png',
      },
      {
        address: 'DezXAZ8z7PnrnRJjzQeCQBmfPtujfq6nCzFFWiP2LsXX',
        symbol: 'BONK',
        name: 'Bonk Token',
        decimals: 0,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/DezXAZ8z7PnrnRJjzQeCQBmfPtujfq6nCzFFWiP2LsXX/logo.png',
      },
      {
        address: '7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU',
        symbol: 'SAMO',
        name: 'Samoyedcoin',
        decimals: 9,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU/logo.png',
      },
      {
        address: 'CopeJxzv7ss9ruvT8WDD7i5ZRtcQBNM6AtURNyagova',
        symbol: 'COPE',
        name: 'COPE Token',
        decimals: 9,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/CopeJxzv7ss9ruvT8WDD7i5ZRtcQBNM6AtURNyagova/logo.png',
      },
      {
        address: 'StepRfZh3P5GbAmMKB3vTf1GhT7jDLpD5ZYhKv9HQ9H',
        symbol: 'STEP',
        name: 'Step Finance',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/StepRfZh3P5GbAmMKB3vTf1GhT7jDLpD5ZYhKv9HQ9H/logo.png',
      }
    ];

    const network = clusterApiUrl('mainnet-beta');
    const connection = new Connection(network, 'confirmed');

    function App() {
      const [walletConnected, setWalletConnected] = useState(false);
      const [publicKey, setPublicKey] = useState(null);
      const [solBalance, setSolBalance] = useState(0);
      const [fromToken, setFromToken] = useState({
        address: SOL_MINT,
        symbol: 'SOL',
        name: 'SOL',
        decimals: 9,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/info/logo.png',
      });
      const [toToken, setToToken] = useState(tokensList[0]);
      const [amount, setAmount] = useState('0');
      const [routes, setRoutes] = useState([]);
      const [selectedRoute, setSelectedRoute] = useState(null);
      const [loadingQuotes, setLoadingQuotes] = useState(false);
      const [swapping, setSwapping] = useState(false);
      const [txStatus, setTxStatus] = useState(null);
      const [tokenBalances, setTokenBalances] = useState({});

      // Connect Phantom wallet
      const connectWallet = useCallback(async () => {
        if (window.solana && window.solana.isPhantom) {
          try {
            await window.solana.connect({ onlyIfTrusted: false });
            const pk = new PublicKey(window.solana.publicKey.toString());
            setPublicKey(pk);
            setWalletConnected(true);
          } catch (err) {
            console.error('Wallet connection failed:', err);
            alert('Failed to connect wallet: ' + (err.message || err));
          }
        } else {
          // Use Phantom deep link for mobile
          if (/android|iphone|ipad|ipod/i.test(navigator.userAgent)) {
            window.open(`https://phantom.app/ul/browse/${encodeURIComponent(window.location.href)}`, '_blank');
          } else {
            alert('Phantom wallet not found. Please install it from https://phantom.app/');
          }
        }
      }, []);

      // Disconnect wallet
      const disconnectWallet = useCallback(async () => {
        if (window.solana && window.solana.isPhantom) {
          try {
            await window.solana.disconnect();
            setWalletConnected(false);
            setPublicKey(null);
            setSolBalance(0);
            setTokenBalances({});
            setRoutes([]);
            setSelectedRoute(null);
            setTxStatus(null);
          } catch (err) {
            console.error('Wallet disconnection failed:', err);
          }
        }
      }, []);

      // Fetch balances when publicKey changes
      useEffect(() => {
        const fetchBalances = async () => {
          if (!publicKey) return;
          try {
            const balance = await connection.getBalance(publicKey);
            setSolBalance(balance / 1e9);

            let balances = {};
            // Fetch SPL token balances
            for (const token of tokensList) {
              try {
                const mintPubkey = new PublicKey(token.address);
                const tokenAccounts = await connection.getTokenAccountsByOwner(publicKey, { mint: mintPubkey });
                if (tokenAccounts.value.length > 0) {
                  const accountInfo = await connection.getParsedAccountInfo(tokenAccounts.value[0].pubkey);
                  const uiAmount = accountInfo.value?.data?.parsed?.info?.tokenAmount?.uiAmount || 0;
                  balances[token.address] = uiAmount;
                } else {
                  balances[token.address] = 0;
                }
              } catch (e) {
                balances[token.address] = 0;
              }
            }
            setTokenBalances(balances);
          } catch (e) {
            console.error('Error fetching balances:', e);
          }
        };
        fetchBalances();
      }, [publicKey]);

      // Phantom wallet event listeners
      useEffect(() => {
        if (!window.solana || !window.solana.isPhantom) return undefined;
        const handleConnect = (pk) => {
          setPublicKey(new PublicKey(pk.toString()));
          setWalletConnected(true);
        };
        const handleDisconnect = () => {
          setWalletConnected(false);
          setPublicKey(null);
          setSolBalance(0);
          setTokenBalances({});
          setRoutes([]);
          setSelectedRoute(null);
          setTxStatus(null);
        };

        window.solana.on('connect', handleConnect);
        window.solana.on('disconnect', handleDisconnect);

        if (window.solana.isConnected) {
          setPublicKey(new PublicKey(window.solana.publicKey.toString()));
          setWalletConnected(true);
        }

        return () => {
          if (window.solana.removeListener) {
            window.solana.removeListener('connect', handleConnect);
            window.solana.removeListener('disconnect', handleDisconnect);
          }
        };
      }, []);

      // Convert amount string to base unit number
      const toLamports = (amountStr, decimals) => {
        const decimalAmount = parseFloat(amountStr);
        if (isNaN(decimalAmount) || decimalAmount <= 0) return 0;
        return Math.round(decimalAmount * 10 ** decimals);
      };

      // Get swap quotes from Jupiter API
      const getSwapQuotes = async () => {
        if (!publicKey) {
          alert('Please connect wallet first');
          return;
        }
        if (!amount || isNaN(parseFloat(amount)) || parseFloat(amount) <= 0) {
          alert('Enter a valid amount');
          return;
        }
        setLoadingQuotes(true);
        setRoutes([]);
        setSelectedRoute(null);

        try {
          const inputMint = fromToken.symbol === 'SOL' ? SOL_MINT : fromToken.address;
          const outputMint = toToken.symbol === 'SOL' ? SOL_MINT : toToken.address;
          const inputAmount = toLamports(amount, fromToken.decimals);
          if (inputAmount === 0) {
            alert('Invalid amount');
            setLoadingQuotes(false);
            return;
          }

          const resp = await axios.get(`${JUPITER_API_BASE}/quote`, {
            params: {
              inputMint,
              outputMint,
              amount: inputAmount,
              slippageBps: 50,
              swapMode: 'ExactIn',
            },
          });

          if (resp.data && resp.data.routes && resp.data.routes.length > 0) {
            setRoutes(resp.data.routes);
            setSelectedRoute(resp.data.routes[0]);
          } else {
            alert('No swap routes found for this pair and amount');
            setRoutes([]);
            setSelectedRoute(null);
          }
        } catch (e) {
          console.error('Failed to fetch swap routes:', e);
          alert('Failed to fetch swap routes');
        }
        setLoadingQuotes(false);
      };

      // Execute the swap using Jupiter swap endpoint
      const executeSwap = async () => {
        if (!publicKey) {
          alert('Connect your wallet first');
          return;
        }
        if (!selectedRoute) {
          alert('No swap route selected');
          return;
        }
        setSwapping(true);
        setTxStatus(null);

        try {
          const resp = await axios.post(`${JUPITER_API_BASE}/swap`, {
            route: selectedRoute,
            userPublicKey: publicKey.toBase58(),
            wrapUnwrapSOL: true,
            dynamicComputeUnitLimit: true,
          });

          if (!resp.data || !resp.data.swapTransaction) {
            alert('Failed to get swap transaction');
            setSwapping(false);
            return;
          }

          const swapTx = Transaction.from(Buffer.from(resp.data.swapTransaction, 'base64'));
          swapTx.feePayer = publicKey;
          const { blockhash } = await connection.getLatestBlockhash();
          swapTx.recentBlockhash = blockhash;

          const signedSwapTx = await window.solana.signTransaction(swapTx);
          const txid = await connection.sendRawTransaction(signedSwapTx.serialize());
          setTxStatus(`Transaction submitted: ${txid}`);
          await connection.confirmTransaction(txid, 'confirmed');
          setTxStatus(`Transaction confirmed: ${txid}`);

          // Refresh balances
          const newSolBalance = await connection.getBalance(publicKey);
          setSolBalance(newSolBalance / 1e9);

          let balances = {};
          for (const token of tokensList) {
            try {
              const mintPubkey = new PublicKey(token.address);
              const tokenAccounts = await connection.getTokenAccountsByOwner(publicKey, { mint: mintPubkey });
              if (tokenAccounts.value.length > 0) {
                const accountInfo = await connection.getParsedAccountInfo(tokenAccounts.value[0].pubkey);
                const uiAmount = accountInfo.value?.data?.parsed?.info?.tokenAmount?.uiAmount || 0;
                balances[token.address] = uiAmount;
              } else {
                balances[token.address] = 0;
              }
            } catch {
              balances[token.address] = 0;
            }
          }
          setTokenBalances(balances);

        } catch (e) {
          if (e?.message) {
            alert(`Swap failed: ${e.message}`);
          } else {
            alert('Swap failed, check console.');
          }
          console.error(e);
        }
        setSwapping(false);
      };

      // Display balance helper
      const displayBalance = (token) => {
        if (token.symbol === 'SOL') {
          return solBalance.toFixed(4);
        }
        return (tokenBalances[token.address] || 0).toFixed(4);
      };

      // Swap "from" and "to" tokens in UI
      const swapFromTo = () => {
        const oldFrom = fromToken;
        setFromToken(toToken);
        setToToken(oldFrom);
        setAmount('0');
        setRoutes([]);
        setSelectedRoute(null);
        setTxStatus(null);
      };

      return (
        <div>
          <h2>Fixorium Solana SPL Token Swap dApp</h2>
          {!walletConnected ? (
            <button onClick={connectWallet} style={{ minWidth: '100%' }}>
              Connect Phantom Wallet
            </button>
          ) : (
            <div style={{ marginBottom: 15 }}>
              <p style={{ wordBreak: 'break-word', userSelect: 'text' }}>
                <b>Wallet:</b> {publicKey?.toBase58()}
              </p>
              <p>
                <b>SOL balance:</b> {solBalance.toFixed(4)} SOL
              </p>
              <button onClick={disconnectWallet} style={{ padding: '6px 12px' }}>
                Disconnect
              </button>
            </div>
          )}

          <fieldset disabled={!walletConnected || loadingQuotes || swapping}>
            <legend>Swap</legend>
            <label htmlFor="fromSelect">From:</label>
            <select
              id="fromSelect"
              value={fromToken.address}
              onChange={(e) => {
                const sel =
                  tokensList.find((t) => t.address === e.target.value) ||
                  (e.target.value === SOL_MINT
                    ? { address: SOL_MINT, symbol: 'SOL', name: 'SOL', decimals: 9, logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/info/logo.png' }
                    : null);
                if (sel) {
                  setFromToken(sel);
                  setRoutes([]);
                  setSelectedRoute(null);
                  setAmount('');
                  setTxStatus(null);
                }
              }}
            >
              <option value={SOL_MINT}>
                <img src="https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/info/logo.png" className="token-logo" alt="SOL" /> SOL
              </option>
              {tokensList.map((token) => (
                <option key={token.address} value={token.address}>
                  {token.symbol}
                </option>
              ))}
            </select>
            <small>Balance: {displayBalance(fromToken)}</small>

            <button className="btn-swap" onClick={swapFromTo} type="button" disabled={!walletConnected || swapping || loadingQuotes}>
              ⇅ Swap from/to
            </button>

            <label htmlFor="toSelect">To:</label>
            <select
              id="toSelect"
              value={toToken.address}
              onChange={(e) => {
                const sel =
                  tokensList.find((t) => t.address === e.target.value) ||
                  (e.target.value === SOL_MINT
                    ? { address: SOL_MINT, symbol: 'SOL', name: 'SOL', decimals: 9, logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/info/logo.png' }
                    : null);
                if (sel) {
                  setToToken(sel);
                  setRoutes([]);
                  setSelectedRoute(null);
                  setAmount('');
                  setTxStatus(null);
                }
              }}
            >
              <option value={SOL_MINT}>SOL</option>
              {tokensList.map((token) => (
                <option key={token.address} value={token.address}>
                  {token.symbol}
                </option>
              ))}
            </select>
            <small>Balance: {displayBalance(toToken)}</small>

            <label htmlFor="amountInput">Amount ({fromToken.symbol}):</label>
            <input
              id="amountInput"
              type="number"
              min="0"
              step="any"
              placeholder="0"
              value={amount}
              onChange={(e) => setAmount(e.target.value)}
              spellCheck="false"
              inputMode="decimal"
            />

            <button
              type="button"
              onClick={getSwapQuotes}
              disabled={loadingQuotes || !amount || parseFloat(amount) <= 0}
              style={{ minWidth: '100%' }}
            >
              {loadingQuotes ? 'Loading quotes...' : 'Get Swap Quote'}
            </button>
          </fieldset>

          {/* Swap routes display */}
          {routes.length > 0 && !loadingQuotes && (
            <fieldset>
              <legend>Quotes</legend>
              <div style={{ maxHeight: 250, overflowY: 'auto' }}>
                {routes.map((r) => {
                  const expectedOut = (parseInt(r.outAmount) / 10 ** toToken.decimals).toFixed(6);
                  const priceImpactPct = (r.priceImpactPct * 100).toFixed(3);
                  const isSelected = selectedRoute?.id === r.id;
                  return (
                    <div
                      key={r.id}
                      className={`route-box${isSelected ? ' selected' : ''}`}
                      onClick={() => setSelectedRoute(r)}
                      title={`Price Impact: ${priceImpactPct}%`}
                      role="button"
                      tabIndex={0}
                      onKeyDown={(e) => {
                        if (e.key === 'Enter' || e.key === ' ') setSelectedRoute(r);
                      }}
                    >
                      <div>
                        <b>Expected Out:</b> {expectedOut} {toToken.symbol}
                      </div>
                      <div>
                        <b>Price Impact:</b> {priceImpactPct}%
                      </div>
                    </div>
                  );
                })}
              </div>
              <button
                type="button"
                onClick={executeSwap}
                disabled={!selectedRoute || swapping}
                style={{ marginTop: 15, minWidth: '100%' }}
              >
                {swapping ? 'Swapping...' : `Swap ${amount} ${fromToken.symbol} → ${toToken.symbol}`}
              </button>
            </fieldset>
          )}

          {txStatus && <p className="status">{txStatus}</p>}

          <footer>
            Powered by Solana, Phantom &amp; <a href="https://jup.ag/" target="_blank" rel="noopener noreferrer">Jupiter Aggregator</a>
          </footer>
        </div>
      );
    }

    const rootElem = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElem);
    root.render(<StrictMode><App /></StrictMode>);
  </script>
</body>
</html>

 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FIXORIUM Wallet (Solana)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css?family=Arial:400,500,700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #181824 0%, #232339 100%);
      color: #e3e7ed;
      font-family: Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      font-size: 13px;
    }
    .header {
      text-align: center;
      font-size: 1.25em;
      font-weight: 700;
      margin: 1.3em 0 0.7em 0;
      color: #9945FF;
      letter-spacing: 0.03em;
    }
    .logo {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      box-shadow: 0 2px 8px #9945ff46;
      margin-bottom: 0.25em;
      background: #fff;
      object-fit: cover;
      display: block;
      margin-left:auto;
      margin-right:auto;
    }
    .connect-btn {
      display: block;
      margin: 0 auto 1em auto;
      background: linear-gradient(90deg, #9945FF, #19FB9B);
      color: #181824;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1em;
      padding: 0.4em 1.2em;
      cursor: pointer;
      box-shadow: 0 2px 10px #9945ff2b;
      transition: background 0.15s;
      min-width: 120px;
    }
    .connect-btn:hover { filter: brightness(1.09); }
    .wallet-info {
      text-align: center;
      margin-bottom: 1.2em;
      font-size: 0.92em;
      background: #232339;
      border-radius: 8px;
      display: inline-block;
      min-width: 180px;
      padding: 0.7em 1em;
      box-shadow: 0 2px 10px #2323392b;
      font-size: 12px;
    }
    .token-list {
      width: 97%;
      max-width: 410px;
      margin: 0 auto;
      background: #232339;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(60,72,88,0.11);
      padding: 0.8em 0.6em;
      font-size: 12px;
    }
    .token-row {
      display: flex;
      align-items: center;
      border-bottom: 1px solid #29294a;
      padding: 0.6em 0.10em;
      cursor: pointer;
      transition: background 0.13s;
      font-size: 12px;
    }
    .token-row:last-child { border-bottom: none; }
    .token-row:hover { background: #191923; }
    .token-img {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      margin-right: 0.6em;
      background: #fff;
      border: 1px solid #9945FF;
      box-shadow: 0 1px 5px #9945ff33;
      object-fit: cover;
    }
    .token-symbol {
      font-weight: 700;
      color: #19FB9B;
      margin-right: 0.5em;
      font-size: 0.95em;
    }
    .token-name {
      color: #b6b8c1;
      font-size: 0.95em;
      margin-right: auto;
      min-width: 68px;
    }
    .token-price {
      color: #ffdc5c;
      font-size: 0.95em;
      margin-right: 0.6em;
      font-weight: bold;
      min-width: 60px;
      text-align: right;
    }
    .token-action {
      background: linear-gradient(90deg, #9945FF, #19FB9B);
      color: #fff;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      font-size: 0.95em;
      padding: 0.2em 0.7em;
      cursor: pointer;
      transition: background 0.15s;
      box-shadow: 0 1px 7px #9945ff2b;
    }
    .token-action:hover { filter: brightness(1.09); }
    .popup-bg {
      position: fixed;
      top:0;left:0;right:0;bottom:0;
      background: rgba(20,20,32,0.85);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .popup-box {
      background: #232339;
      border-radius: 10px;
      box-shadow: 0 3px 16px rgba(80,100,120,0.16);
      padding: 1em 0.7em;
      max-width: 320px;
      width: 93vw;
      text-align: center;
      color: #e3e7ed;
      font-size:13px;
    }
    .popup-title {
      font-size: 1em;
      font-weight: bold;
      color: #9945FF;
      margin-bottom: 0.7em;
    }
    .popup-btn {
      background: linear-gradient(90deg, #9945FF, #19FB9B);
      color: #181824;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.95em;
      padding: 0.4em 1em;
      margin: 0.3em 0;
      cursor: pointer;
      width: 100%;
      transition: background 0.15s;
      box-shadow: 0 1px 7px #9945ff2b;
    }
    .popup-btn:hover { filter: brightness(1.07); }
    .popup-close {
      margin-top: 1em;
      color: #b6b8c1;
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.92em;
    }
    .popup-row {
      margin: 0.6em 0;
      text-align: left;
      font-size:12px;
    }
    .popup-label {
      font-weight: 600;
      margin-bottom: 0.15em;
      display: block;
      font-size:12px;
    }
    .popup-input, .popup-select {
      width: 100%;
      padding: 0.38em 0.63em;
      border-radius: 6px;
      border: 1px solid #29294a;
      font-size: 0.95em;
      background: #181824;
      color: #e3e7ed;
      font-family: Arial, sans-serif;
      margin-bottom: 0.25em;
    }
    .popup-status {
      margin-top: 0.8em;
      color: #19FB9B;
      font-size: 0.93em;
      min-height: 1.1em;
    }
    .popup-error {
      color: #ff5c91;
      font-size: 0.93em;
      min-height: 1.1em;
      margin-top: 0.7em;
    }
    .qr-box {
      margin: 1em auto 0 auto;
      text-align: center;
    }
    .powered {
      text-align: center;
      color: #b6b8c1;
      margin: 1.4em 0 0.5em 0;
      font-size: 0.84em;
      letter-spacing: 0.01em;
    }
    @media (max-width: 600px) {
      .header { font-size: 1.1em; }
      .logo { width: 29px; height: 29px; }
      .wallet-info { min-width: 120px; padding: 0.4em 0.8em; font-size:11px;}
      .token-list {max-width:98vw;}
      .popup-box {max-width:97vw;}
    }
  </style>
</head>
<body>
  <div class="header">
    <img class="logo" src="https://cryptologos.cc/logos/solana-sol-logo.png?v=024" alt="Fixorium Logo"/>
    FIXORIUM Wallet (Solana Network)
  </div>
  <button class="connect-btn" id="connectBtn">Connect Wallet</button>
  <div class="wallet-info" id="walletInfo"></div>
  <div class="token-list" id="tokenList"></div>
  <div class="powered">
    Powered by <a href="https://jup.ag/" target="_blank" style="color:#9945FF;">Jupiter</a> & <a href="https://www.coingecko.com/" target="_blank" style="color:#19FB9B;">CoinGecko</a>
  </div>
  <div id="popupRoot"></div>
  
  <!-- Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    // Solana token list with CoinGecko IDs for price
    const TOKENS = [
      { symbol: "SOL", name: "Solana", mint: "So11111111111111111111111111111111111111112", decimals: 9, image: "https://cryptologos.cc/logos/solana-sol-logo.png", cgId: "solana" },
      { symbol: "BONK", name: "Bonk", mint: "DezX1xQ6ZhhXPb9D5e8C2J9pYc3i8c1a6h8VfmYbZ3Qh", decimals: 5, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/DezX1xQ6ZhhXPb9D5e8C2J9pYc3i8c1a6h8VfmYbZ3Qh/logo.png", cgId: "bonk" },
      { symbol: "MEW", name: "cat in a dogs world", mint: "6cA7QVY6L9Dn7dEyEfrXzQK6pQ6TjA2R8fLJwNr1cCzN", decimals: 6, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/6cA7QVY6L9Dn7dEyEfrXzQK6pQ6TjA2R8fLJwNr1cCzN/logo.png", cgId: "cat-in-a-dogs-world" },
      { symbol: "USDT", name: "Tether USD", mint: "Es9vMFrzaCERdQWXTQb1p8KXbmP1kRYzT9YjZ5jL3kJ9", decimals: 6, image: "https://cryptologos.cc/logos/tether-usdt-logo.png", cgId: "tether" }
    ];

    let wallet = null; // {address, balance, type, provider}
    let tokenPrices = {};
    let tokenPriceFetchError = false;

    // CoinGecko price fetch
    async function fetchTokenPrices() {
      try {
        const ids = TOKENS.map(t => t.cgId).join(",");
        const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Price API Error");
        const data = await res.json();
        tokenPrices = {};
        TOKENS.forEach(t => {
          if (t.cgId && data[t.cgId] && data[t.cgId].usd)
            tokenPrices[t.symbol] = data[t.cgId].usd;
          else
            tokenPrices[t.symbol] = null;
        });
        tokenPriceFetchError = false;
      } catch (e) {
        tokenPriceFetchError = true;
        TOKENS.forEach(t => { tokenPrices[t.symbol] = null; });
      }
      renderTokens();
    }

    // Popup utilities
    function showPopup(html) {
      document.getElementById("popupRoot").innerHTML = `<div class="popup-bg"><div class="popup-box">${html}</div></div>`;
    }
    function closePopup() {
      document.getElementById("popupRoot").innerHTML = '';
    }

    // Connect options: Phantom, Solflare, WalletConnect (Solana)
    function showConnectPopup() {
      showPopup(`
        <div class="popup-title">Connect Solana Wallet</div>
        <button class="popup-btn" onclick="window.connectPhantom()">Phantom Wallet</button>
        <button class="popup-btn" onclick="window.connectSolflare()">Solflare Wallet</button>
        <button class="popup-btn" onclick="window.connectWalletConnect()">WalletConnect (Scan with Phantom/Solflare Mobile)</button>
        <div id="qrBox"></div>
        <div class="popup-status" id="connectStatus"></div>
        <div class="popup-close" onclick="closePopup()">Cancel</div>
      `);
    }

    // Phantom extension
    window.connectPhantom = async function() {
      const statusEl = document.getElementById("connectStatus");
      if (window.solana && window.solana.isPhantom) {
        statusEl.textContent = "Connecting...";
        try {
          const resp = await window.solana.connect({ onlyIfTrusted: false });
          const address = resp.publicKey.toString();
          const conn = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
          const balanceLamports = await conn.getBalance(new solanaWeb3.PublicKey(address));
          const balanceSol = (balanceLamports / 1e9).toFixed(4);
          wallet = { address, balance: balanceSol, type: "Phantom", provider: window.solana };
          updateWalletInfo();
          hideConnectBtn();
          closePopup();
        } catch (e) {
          statusEl.textContent = "Phantom connection failed!";
        }
      } else {
        statusEl.innerHTML = `Phantom not found! <a href="https://phantom.app/download" target="_blank" style="color:#19FB9B">Install Here</a>`;
      }
    };

    // Solflare extension
    window.connectSolflare = async function() {
      const statusEl = document.getElementById("connectStatus");
      if (window.solflare) {
        statusEl.textContent = "Connecting...";
        try {
          const resp = await window.solflare.connect();
          const address = resp.publicKey.toString();
          const conn = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
          const balanceLamports = await conn.getBalance(new solanaWeb3.PublicKey(address));
          const balanceSol = (balanceLamports / 1e9).toFixed(4);
          wallet = { address, balance: balanceSol, type: "Solflare", provider: window.solflare };
          updateWalletInfo();
          hideConnectBtn();
          closePopup();
        } catch (e) {
          statusEl.textContent = "Solflare connection failed!";
        }
      } else {
        statusEl.innerHTML = `Solflare not found! <a href="https://solflare.com/download" target="_blank" style="color:#19FB9B">Install Here</a>`;
      }
    };

    // WalletConnect for Solana (QR code for mobile Phantom/Solflare)
    window.connectWalletConnect = async function() {
      const statusEl = document.getElementById("connectStatus");
      statusEl.textContent = "Initializing WalletConnect...";
      // Demo QR: not a real WalletConnect implementation, but you can integrate a real one using WalletConnect Solana Provider
      const qrBox = document.getElementById("qrBox");
      const fakeWCURI = "wc:demo-solana-walletconnect";
      qrBox.innerHTML = "";
      window.QRCode.toCanvas(document.createElement('canvas'), fakeWCURI, {
        width: 180, margin: 2,
        color: { dark: "#9945FF", light: "#232339"}
      }, function(error, canvas) {
        if (!error) qrBox.appendChild(canvas);
      });
      qrBox.innerHTML += `<div style="margin-top:0.5em;color:#19FB9B;">
        Scan with Phantom/Solflare Mobile (WalletConnect)<br>
        <span style="font-size:10px;">[Demo QR only]</span>
      </div>`;
      // For a real WalletConnect Solana provider, use https://github.com/walletconnect/solana-provider
    };

    // Hide connect button, show wallet info
    function hideConnectBtn() {
      document.getElementById("connectBtn").style.display = "none";
    }
    function showConnectBtn() {
      document.getElementById("connectBtn").style.display = "";
    }

    // Update wallet info
    function updateWalletInfo() {
      const el = document.getElementById("walletInfo");
      if (wallet) {
        el.innerHTML = `
          <div>Connected: <span style="color:#19FB9B;">${wallet.address.slice(0,6)}...${wallet.address.slice(-4)}</span></div>
          <div>SOL Balance: <span style="color:#19FB9B;">${wallet.balance}</span></div>
          <div style="margin-top:0.25em;color:#9945FF;">Wallet: ${wallet.type}</div>
        `;
      } else {
        el.textContent = "";
        showConnectBtn();
      }
    }

    // Render token table
    function renderTokens() {
      let html = '';
      TOKENS.forEach((t, i) => {
        let priceStr = 'Loading...';
        if (tokenPrices[t.symbol] === null && tokenPriceFetchError) {
          priceStr = `<span style="color: #ff5c91;">Unavailable</span>`;
        } else if (tokenPrices[t.symbol] !== undefined && tokenPrices[t.symbol] !== null) {
          priceStr = `$${tokenPrices[t.symbol].toLocaleString(undefined, {minimumFractionDigits: 3, maximumFractionDigits: 8})}`;
        }
        html += `
          <div class="token-row" onclick="showTradePopup(${i})">
            <img class="token-img" src="${t.image}" alt="${t.symbol}" />
            <span class="token-symbol">${t.symbol}</span>
            <span class="token-name">${t.name}</span>
            <span class="token-price" id="price-${t.symbol}">${priceStr}</span>
            <button class="token-action" onclick="event.stopPropagation();showTradePopup(${i})">Buy/Sell</button>
          </div>
        `;
      });
      document.getElementById("tokenList").innerHTML = html;
    }

    // Trade popup
    window.showTradePopup = function(idx) {
      const t = TOKENS[idx];
      const solPrice = tokenPrices["SOL"];
      const usdtPrice = tokenPrices["USDT"];
      let priceSection = '';
      if (tokenPrices[t.symbol] !== undefined && tokenPrices[t.symbol] !== null) {
        priceSection = `<div style="margin-bottom:0.3em;color:#ffdc5c;font-size:1.05em;">
          ${t.symbol} Price: $${tokenPrices[t.symbol]} ${t.symbol==="USDT"?"":"<span style='color:#b6b8c1;font-size:0.98em;'>(SOL Price: $"+solPrice+")</span>"}
        </div>`;
      }
      let balanceSection = '';
      if (wallet && wallet.balance) {
        balanceSection = `<div style="color:#19FB9B;margin-bottom:0.3em;">Your SOL Balance: ${wallet.balance}</div>`;
      }
      showPopup(`
        <div class="popup-title">
          Trade ${t.name} (${t.symbol})
        </div>
        ${priceSection}
        ${balanceSection}
        <div class="popup-row">
          <label class="popup-label" for="tradeSide">Type:</label>
          <select class="popup-select" id="tradeSide" onchange="window.updateTradeAmountLabel(${idx})">
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
          </select>
        </div>
        <div class="popup-row">
          <label class="popup-label" id="tradeAmountLabel" for="tradeAmount">Amount (in ${t.symbol==="USDT"?"USDT":"SOL"}):</label>
          <input class="popup-input" id="tradeAmount" type="number" min="0" placeholder="Amount">
        </div>
        <button class="popup-btn" onclick="window.startTrade(${idx})">Execute Trade</button>
        <div class="popup-status" id="tradeStatus"></div>
        <div class="popup-close" onclick="closePopup()">Cancel</div>
      `);
    };

    // Update buy/sell label
    window.updateTradeAmountLabel = function(idx) {
      const t = TOKENS[idx];
      const side = document.getElementById("tradeSide").value;
      let label = "";
      if (side==="buy") {
        label = `Amount (in SOL or USDT):`;
      } else {
        label = `Amount (in ${t.symbol}):`;
      }
      document.getElementById("tradeAmountLabel").textContent = label;
    };

    // Jupiter API for swap
    window.startTrade = async function(idx) {
      const t = TOKENS[idx];
      const statusEl = document.getElementById("tradeStatus");
      if (!wallet || !wallet.address || !wallet.provider) {
        statusEl.textContent = "Connect wallet first!";
        return;
      }
      const side = document.getElementById("tradeSide").value;
      let amount = parseFloat(document.getElementById("tradeAmount").value);
      if (!amount || amount <= 0) {
        statusEl.textContent = "Enter valid amount.";
        return;
      }
      // Only SOLANA network
      statusEl.textContent = "Fetching quote...";
      try {
        let fromMint, toMint, decimals, amountRaw;
        if (side === "buy") {
          // Buy token with SOL or USDT (decide based on input field; if input is USDT, use USDT as fromMint)
          // Default: buy with SOL
          fromMint = TOKENS[0].mint; // SOL
          toMint = t.mint;
          decimals = TOKENS[0].decimals;
          amountRaw = Math.floor(amount * Math.pow(10, decimals));
          // If user wants to buy with USDT, check if USDT is selected or entered
          // (optional advanced logic: you can add a radio button for USDT/SOL)
        } else {
          // Sell token for SOL
          fromMint = t.mint;
          toMint = TOKENS[0].mint; // SOL
          decimals = t.decimals;
          amountRaw = Math.floor(amount * Math.pow(10, decimals));
        }
        const quoteUrl = `https://quote-api.jup.ag/v6/quote?inputMint=${fromMint}&outputMint=${toMint}&amount=${amountRaw}&slippageBps=30`;
        const quoteRes = await fetch(quoteUrl);
        const quote = await quoteRes.json();
        if (!quote.routes || !quote.routes.length) throw new Error("No swap route found.");
        statusEl.textContent = "Building swap transaction...";
        const swapRes = await fetch("https://quote-api.jup.ag/v6/swap", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({
            route: quote.routes[0],
            userPublicKey: wallet.address,
            wrapUnwrapSOL: true,
            dynamicComputeUnitLimit: true
          })
        });
        const swapData = await swapRes.json();
        if (!swapData.swapTransaction) throw new Error("Failed to build swap transaction.");
        statusEl.textContent = "Signing transaction...";
        let signedTx, txid;
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
        const tx = solanaWeb3.Transaction.from(Buffer.from(swapData.swapTransaction, "base64"));
        tx.feePayer = new solanaWeb3.PublicKey(wallet.address);
        tx.recentBlockhash = (await connection.getRecentBlockhash()).blockhash;
        signedTx = await wallet.provider.signTransaction(tx);
        statusEl.textContent = "Sending transaction...";
        txid = await connection.sendRawTransaction(signedTx.serialize());
        statusEl.textContent = "Confirming transaction...";
        await connection.confirmTransaction(txid, "finalized");
        statusEl.innerHTML = `Trade successful!<br>Tx: <a href="https://solscan.io/tx/${txid}" target="_blank" style="color:#19FB9B">${txid}</a>`;
      } catch (e) {
        statusEl.textContent = "Trade failed: " + (e.message || e);
      }
    };

    document.getElementById("connectBtn").onclick = showConnectPopup;

    // Initial load
    fetchTokenPrices();
    setInterval(fetchTokenPrices, 60000); // Refresh prices every 60s
    renderTokens();
    updateWalletInfo();
  </script>
</body>
</html>

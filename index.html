 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FIXORIUM Wallet</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css?family=Arial:400,500,700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #181824 0%, #232339 100%);
      color: #e3e7ed;
      font-family: Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
    }
    .header {
      text-align: center;
      font-size: 2em;
      font-weight: 700;
      margin: 2em 0 1em 0;
      color: #9945FF;
      letter-spacing: 0.03em;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .logo {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      box-shadow: 0 6px 24px #9945ff46;
      margin-bottom: 0.5em;
      background: #fff;
      object-fit: cover;
    }
    .connect-btn {
      display: block;
      margin: 0 auto 1.5em auto;
      background: linear-gradient(90deg, #9945FF, #19FB9B);
      color: #181824;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1.2em;
      padding: 0.7em 2em;
      cursor: pointer;
      box-shadow: 0 2px 12px #9945ff2b;
      transition: background 0.15s;
    }
    .connect-btn:hover { filter: brightness(1.09); }
    .wallet-info {
      text-align: center;
      margin-bottom: 2em;
      font-size: 1.1em;
      background: #232339;
      border-radius: 10px;
      display: inline-block;
      min-width: 270px;
      padding: 1em 1.5em;
      box-shadow: 0 2px 18px #2323392b;
    }
    .token-list {
      width: 96%;
      max-width: 700px;
      margin: 0 auto;
      background: #232339;
      border-radius: 18px;
      box-shadow: 0 4px 20px rgba(60,72,88,0.14);
      padding: 1.2em 1em;
    }
    .token-row {
      display: flex;
      align-items: center;
      border-bottom: 1px solid #29294a;
      padding: 1em 0.2em;
      cursor: pointer;
      transition: background 0.13s;
    }
    .token-row:last-child { border-bottom: none; }
    .token-row:hover { background: #191923; }
    .token-img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      margin-right: 1em;
      background: #fff;
      border: 2px solid #9945FF;
      box-shadow: 0 2px 10px #9945ff33;
      object-fit: cover;
    }
    .token-symbol {
      font-weight: 700;
      color: #19FB9B;
      margin-right: 0.8em;
      font-size: 1.1em;
    }
    .token-name {
      color: #b6b8c1;
      font-size: 1.08em;
      margin-right: auto;
    }
    .token-action {
      background: linear-gradient(90deg, #9945FF, #19FB9B);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1em;
      padding: 0.4em 1em;
      cursor: pointer;
      transition: background 0.15s;
      box-shadow: 0 2px 12px #9945ff2b;
    }
    .token-action:hover { filter: brightness(1.09); }
    .popup-bg {
      position: fixed;
      top:0;left:0;right:0;bottom:0;
      background: rgba(20,20,32,0.85);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .popup-box {
      background: #232339;
      border-radius: 16px;
      box-shadow: 0 6px 32px rgba(80,100,120,0.16);
      padding: 2em 1.5em;
      max-width: 340px;
      width: 94vw;
      text-align: center;
      color: #e3e7ed;
    }
    .popup-title {
      font-size: 1.15em;
      font-weight: bold;
      color: #9945FF;
      margin-bottom: 1em;
    }
    .popup-btn {
      background: linear-gradient(90deg, #9945FF, #19FB9B);
      color: #181824;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1em;
      padding: 0.5em 1em;
      margin: 0.5em 0;
      cursor: pointer;
      width: 100%;
      transition: background 0.15s;
      box-shadow: 0 2px 12px #9945ff2b;
    }
    .popup-btn:hover { filter: brightness(1.08); }
    .popup-close {
      margin-top: 1.2em;
      color: #b6b8c1;
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.98em;
    }
    .popup-row {
      margin: 1em 0;
      text-align: left;
    }
    .popup-label {
      font-weight: 600;
      margin-bottom: 0.3em;
      display: block;
    }
    .popup-input, .popup-select {
      width: 100%;
      padding: 0.55em 0.9em;
      border-radius: 8px;
      border: 1px solid #29294a;
      font-size: 1em;
      background: #181824;
      color: #e3e7ed;
      font-family: Arial, sans-serif;
      margin-bottom: 0.6em;
    }
    .popup-status {
      margin-top: 1em;
      color: #19FB9B;
      font-size: 1.01em;
      min-height: 1.3em;
    }
    .popup-error {
      color: #ff5c91;
      font-size: 1.01em;
      min-height: 1.3em;
      margin-top: 1em;
    }
    .powered {
      text-align: center;
      color: #b6b8c1;
      margin: 2em 0 0.5em 0;
      font-size: 0.93em;
      letter-spacing: 0.02em;
    }
    @media (max-width: 600px) {
      .header { font-size: 1.4em; }
      .logo { width: 54px; height: 54px; }
      .wallet-info { min-width: 180px; padding: 0.7em 0.9em; }
    }
  </style>
</head>
<body>
  <div class="header">
    <img class="logo" src="https://cryptologos.cc/logos/solana-sol-logo.png?v=024" alt="Fixorium Logo"/>
    FIXORIUM Wallet
  </div>
  <button class="connect-btn" id="connectBtn">Connect Wallet</button>
  <div class="wallet-info" id="walletInfo"></div>
  <div class="token-list" id="tokenList"></div>
  <div class="powered">
    Powered by <a href="https://jup.ag/" target="_blank" style="color:#9945FF;">Jupiter</a> (Solana) & <a href="https://www.1inch.io/" target="_blank" style="color:#19FB9B;">1inch</a> (EVM)
  </div>
  <div id="popupRoot"></div>
  
  <!-- Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    // Demo token list: add one EVM token for swap example
    const TOKENS = [
      { symbol: "SOL", name: "Solana", mint: "So11111111111111111111111111111111111111112", decimals: 9, image: "https://cryptologos.cc/logos/solana-sol-logo.png" },
      { symbol: "BONK", name: "Bonk", mint: "DezX1xQ6ZhhXPb9D5e8C2J9pYc3i8c1a6h8VfmYbZ3Qh", decimals: 5, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/DezX1xQ6ZhhXPb9D5e8C2J9pYc3i8c1a6h8VfmYbZ3Qh/logo.png" },
      { symbol: "MEW", name: "cat in a dogs world", mint: "6cA7QVY6L9Dn7dEyEfrXzQK6pQ6TjA2R8fLJwNr1cCzN", decimals: 6, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/6cA7QVY6L9Dn7dEyEfrXzQK6pQ6TjA2R8fLJwNr1cCzN/logo.png" },
      // EVM example (ETH/USDC)
      { symbol: "ETH", name: "Ethereum", address: "0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE", decimals: 18, isEvm: true, image: "https://cryptologos.cc/logos/ethereum-eth-logo.png" },
      { symbol: "USDC", name: "USD Coin", address: "0xA0b86991c6218b36c1d19d4a2e9eb0ce3606eb48", decimals: 6, isEvm: true, image: "https://cryptologos.cc/logos/usd-coin-usdc-logo.png" }
    ];

    let wallet = null; // { address, balance, type, chain }
    let evmProvider = null; // ethers.js provider

    // Popup utilities
    function showPopup(html) {
      document.getElementById("popupRoot").innerHTML = `<div class="popup-bg"><div class="popup-box">${html}</div></div>`;
    }
    function closePopup() {
      document.getElementById("popupRoot").innerHTML = '';
    }

    // Connect wallet popup
    function showConnectPopup() {
      showPopup(`
        <div class="popup-title">Connect Your Wallet</div>
        <button class="popup-btn" onclick="window.connectPhantom()">Phantom Extension (Solana)</button>
        <button class="popup-btn" onclick="window.connectMetaMaskOrBrave()">MetaMask/Brave Extension (EVM)</button>
        <div class="popup-status" id="connectStatus"></div>
        <div class="popup-close" onclick="closePopup()">Cancel</div>
      `);
    }

    // Phantom connect
    window.connectPhantom = async function() {
      const statusEl = document.getElementById("connectStatus");
      if (window.solana && window.solana.isPhantom) {
        statusEl.textContent = "Connecting to Phantom...";
        try {
          const resp = await window.solana.connect({ onlyIfTrusted: false });
          const address = resp.publicKey.toString();
          const conn = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
          const balanceLamports = await conn.getBalance(new solanaWeb3.PublicKey(address));
          const balanceSol = (balanceLamports / 1e9).toFixed(4);
          wallet = { address, balance: balanceSol, type: "Phantom (Solana)", chain: "solana" };
          evmProvider = null;
          updateWalletInfo();
          closePopup();
        } catch (e) {
          statusEl.textContent = "Phantom connection failed!";
        }
      } else {
        statusEl.innerHTML = `Phantom wallet not found! <a href="https://phantom.app/download" target="_blank" style="color:#19FB9B">Install Here</a>`;
      }
    };

    // MetaMask/Brave connect (with robust error handling)
    window.connectMetaMaskOrBrave = async function() {
      const statusEl = document.getElementById("connectStatus");
      if (window.ethereum) {
        statusEl.textContent = "Connecting to browser wallet...";
        try {
          // Check if MetaMask/Brave is locked
          let accounts;
          try {
            accounts = await window.ethereum.request({ method: 'eth_accounts' });
            if (!accounts || accounts.length === 0) {
              // Not authorized yet, request access
              accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            }
          } catch (err) {
            statusEl.textContent = "Please unlock your MetaMask/Brave wallet and approve the connection!";
            return;
          }
          if (!accounts || accounts.length === 0) {
            statusEl.textContent = "No accounts found. Please unlock your wallet!";
            return;
          }
          evmProvider = new ethers.providers.Web3Provider(window.ethereum);
          const address = accounts[0];
          let balanceEth = "0.0";
          try {
            const balanceWei = await evmProvider.getBalance(address);
            balanceEth = ethers.utils.formatEther(balanceWei);
          } catch (balanceErr) {
            statusEl.textContent = "Failed to fetch balance. Still connected!";
          }
          let type = "MetaMask (EVM)";
          if (window.ethereum.isBraveWallet) type = "Brave Wallet (EVM)";
          wallet = { address, balance: parseFloat(balanceEth).toFixed(4), type, chain: "evm" };
          updateWalletInfo();
          closePopup();
        } catch (e) {
          statusEl.textContent = "Browser wallet connection failed! " + (e.message || e);
        }
      } else {
        statusEl.innerHTML = `No browser wallet detected! <a href="https://metamask.io/download.html" target="_blank" style="color:#19FB9B">Install MetaMask</a>`;
      }
    };

    // Update wallet info
    function updateWalletInfo() {
      const el = document.getElementById("walletInfo");
      if (wallet) {
        el.innerHTML = `
          <div>Connected: <span style="color:#19FB9B;">${wallet.address}</span></div>
          <div>Balance: <span style="color:#19FB9B;">${wallet.balance}</span> (${wallet.chain === "solana"?"SOL":"ETH"})</div>
          <div style="margin-top:0.3em;color:#9945FF;font-size:0.98em;">Wallet: ${wallet.type}</div>
        `;
      } else {
        el.textContent = "";
      }
    }

    // Render token table
    function renderTokens() {
      let html = '';
      TOKENS.forEach((t, i) => {
        html += `
          <div class="token-row" onclick="showTradePopup(${i})">
            <img class="token-img" src="${t.image}" alt="${t.symbol}" />
            <span class="token-symbol">${t.symbol}</span>
            <span class="token-name">${t.name}</span>
            <button class="token-action" onclick="event.stopPropagation();showTradePopup(${i})">Buy/Sell</button>
          </div>
        `;
      });
      document.getElementById("tokenList").innerHTML = html;
    }

    // Trade popup
    window.showTradePopup = function(idx) {
      const t = TOKENS[idx];
      showPopup(`
        <div class="popup-title">
          Trade ${t.name} (${t.symbol})
        </div>
        <div class="popup-row">
          <label class="popup-label" for="tradeSide">Type:</label>
          <select class="popup-select" id="tradeSide">
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
          </select>
        </div>
        <div class="popup-row">
          <label class="popup-label" for="tradeAmount">Amount:</label>
          <input class="popup-input" id="tradeAmount" type="number" min="0" placeholder="Amount">
        </div>
        <button class="popup-btn" onclick="window.startTrade(${idx})">Execute Trade</button>
        <div class="popup-status" id="tradeStatus"></div>
        <div class="popup-close" onclick="closePopup()">Cancel</div>
      `);
    };

    // Jupiter API integration for Solana swaps
    // 1inch API for EVM swaps
    window.startTrade = async function(idx) {
      const t = TOKENS[idx];
      const statusEl = document.getElementById("tradeStatus");
      if (!wallet || !wallet.address) {
        statusEl.textContent = "Connect wallet first!";
        return;
      }
      const side = document.getElementById("tradeSide").value;
      const amount = parseFloat(document.getElementById("tradeAmount").value);
      if (!amount || amount <= 0) {
        statusEl.textContent = "Enter valid amount.";
        return;
      }
      // SOLANA SWAP
      if (wallet.chain === "solana" && !t.isEvm) {
        statusEl.textContent = "Fetching quote...";
        try {
          const fromMint = side === "buy" ? TOKENS[0].mint : t.mint;
          const toMint = side === "buy" ? t.mint : TOKENS[0].mint;
          const decimals = side === "buy" ? TOKENS[0].decimals : t.decimals;
          const amountRaw = Math.floor(amount * Math.pow(10, decimals));
          // Jupiter quote
          const quoteUrl = `https://quote-api.jup.ag/v6/quote?inputMint=${fromMint}&outputMint=${toMint}&amount=${amountRaw}&slippageBps=30`;
          const quoteRes = await fetch(quoteUrl);
          const quote = await quoteRes.json();
          if (!quote.routes || !quote.routes.length) throw new Error("No swap route found.");
          statusEl.textContent = "Building swap transaction...";
          const swapRes = await fetch("https://quote-api.jup.ag/v6/swap", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
              route: quote.routes[0],
              userPublicKey: wallet.address,
              wrapUnwrapSOL: true,
              dynamicComputeUnitLimit: true
            })
          });
          const swapData = await swapRes.json();
          if (!swapData.swapTransaction) throw new Error("Failed to build swap transaction.");
          statusEl.textContent = "Signing transaction...";
          let signedTx, txid;
          const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
          const tx = solanaWeb3.Transaction.from(Buffer.from(swapData.swapTransaction, "base64"));
          tx.feePayer = new solanaWeb3.PublicKey(wallet.address);
          tx.recentBlockhash = (await connection.getRecentBlockhash()).blockhash;
          signedTx = await window.solana.signTransaction(tx);
          statusEl.textContent = "Sending transaction...";
          txid = await connection.sendRawTransaction(signedTx.serialize());
          statusEl.textContent = "Confirming transaction...";
          await connection.confirmTransaction(txid, "finalized");
          statusEl.innerHTML = `Trade successful!<br>Tx: <a href="https://solscan.io/tx/${txid}" target="_blank" style="color:#19FB9B">${txid}</a>`;
        } catch (e) {
          statusEl.textContent = "Trade failed: " + (e.message || e);
        }
        return;
      }
      // EVM SWAP (1inch API)
      if (wallet.chain === "evm" && t.isEvm) {
        statusEl.textContent = "Fetching quote...";
        try {
          // Only ETH <-> USDC for demo, you can expand for other tokens
          const chainId = 1; // Ethereum Mainnet
          const fromToken = side === "buy" ? TOKENS[3].address : t.address;
          const toToken = side === "buy" ? t.address : TOKENS[3].address;
          const decimals = side === "buy" ? TOKENS[3].decimals : t.decimals;
          const amountRaw = ethers.utils.parseUnits(amount.toString(), decimals).toString();
          // 1inch quote
          const quoteUrl = `https://api.1inch.io/v5.0/${chainId}/quote?fromTokenAddress=${fromToken}&toTokenAddress=${toToken}&amount=${amountRaw}`;
          const quoteRes = await fetch(quoteUrl);
          const quote = await quoteRes.json();
          if (!quote.toTokenAmount) throw new Error("No swap route found.");
          statusEl.textContent = "Building swap transaction...";
          // 1inch swap API
          const swapUrl = `https://api.1inch.io/v5.0/${chainId}/swap?fromTokenAddress=${fromToken}&toTokenAddress=${toToken}&amount=${amountRaw}&fromAddress=${wallet.address}&slippage=1`;
          const swapRes = await fetch(swapUrl);
          const swap = await swapRes.json();
          if (!swap.tx) throw new Error("Failed to build swap transaction.");

          // Send transaction using ethers.js
          statusEl.textContent = "Sending transaction...";
          const signer = evmProvider.getSigner();
          const txResponse = await signer.sendTransaction({
            to: swap.tx.to,
            data: swap.tx.data,
            value: ethers.BigNumber.from(swap.tx.value || "0")
          });
          statusEl.textContent = "Confirming transaction...";
          await txResponse.wait();
          statusEl.innerHTML = `Trade successful!<br>Tx: <a href="https://etherscan.io/tx/${txResponse.hash}" target="_blank" style="color:#19FB9B">${txResponse.hash}</a>`;
        } catch (e) {
          statusEl.textContent = "Trade failed: " + (e.message || e);
        }
        return;
      }
      statusEl.textContent = "Swap not supported for this token/wallet!";
    };

    document.getElementById("connectBtn").onclick = showConnectPopup;
    renderTokens();
    updateWalletInfo();
  </script>
</body>
</html>

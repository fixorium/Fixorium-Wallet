 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FIXORIUM WALLET</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
  <style>
    body { margin:0; background:#111; color:#fff; font-family:Arial,sans-serif; font-size:12px; }
    header { display:flex; justify-content:space-between; align-items:center; background:#181818; padding:7px 12px; }
    #logo-left { font-size:1.1rem; font-weight:700; color:#00ffa8; letter-spacing:0.02em; }
    #wallet-row { display:flex; gap:7px; align-items:center; }
    #connectWalletBtn, #disconnectWalletBtn, .tinybar-btn {
      background:#00ffa8; border:none; color:#111; font-weight:700; padding:4px 15px; border-radius:5px;
      cursor:pointer; min-width:60px; font-size:12px; transition:background .18s;
      box-shadow:0 1px 6px #00ffa833;
      margin:2px;
      text-transform:uppercase;
    }
    #connectWalletBtn:hover, .tinybar-btn:hover { background:#fff; color:#111; }
    #disconnectWalletBtn { background: #2e2c47; color:#fff; border:1.3px solid #00ffa8; }
    #disconnectWalletBtn:hover { background:#00ffa8; color:#111; }
    #walletAddress { font-size:11px; color:#00ffa8; padding-left:8px; letter-spacing:0.02em;}
    main { max-width:900px; margin:0 auto; padding:16px 8px 64px; }
    #totalBalance { font-size:1rem; margin-bottom:10px; font-weight:700; color:#00ff99; text-align:center; min-height:1.5em; letter-spacing:0.04em; }
    .tokens-list-holder { width:100%; display:flex; justify-content:center; margin-bottom:0; }
    .tokens-list {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(100px,1fr));
      gap:8px;
      margin-bottom:13px;
      max-width:650px;
      width:100%;
      justify-content:center;
      align-items:center;
    }
    .token-item {
      background:#181c22;
      border-radius:8px;
      box-shadow:0 1px 6px #00ffa824;
      display:flex;flex-direction:column;align-items:center;user-select:none;
      padding:9px 2px 8px;
      justify-content:center;
      min-height:50px; min-width:70px; max-width:120px;
      transition: box-shadow .08s;
      font-size:11px;
      text-align:center;
    }
    .token-item:hover { box-shadow:0 1px 10px #00ffa844; }
    .token-symbol { font-weight:700; font-size:11px; color:#00ffa8; margin-bottom:3px; text-align:center; letter-spacing:0.05em; }
    .token-balance, .token-price { font-size:11px; white-space:nowrap; display:flex;align-items:center;gap:2px; text-transform:uppercase;}
    .tiny-buy-btn, .tiny-sell-btn {
      border:1px solid; border-radius:5px; padding:0px 4px; font-weight:700; font-size:9px; user-select:none; min-width:18px;
      text-align:center; background:transparent; letter-spacing:0.03em; text-transform:uppercase;
      height:15px; display:inline-flex;align-items:center;justify-content:center;transition:background .12s;
      margin-left:2px; margin-top:2px;
      line-height:1;
    }
    .tiny-buy-btn { color:#16c784; border-color:#16c784; background:rgba(22,199,132,0.11);}
    .tiny-sell-btn { color:#ea3943; border-color:#ea3943; background:rgba(234,57,67,0.11);}
    .blink { animation:blinky 0.7s steps(1) infinite; }
    @keyframes blinky {0%{opacity:1;} 50%{opacity:.35;} 100%{opacity:1;}}
    .dot-loader { display:inline-flex; gap:2px; user-select:none; }
    .dot-loader span { background:#0ee; width:3px; height:3px; border-radius:50%;display:inline-block;animation:bounce 1.2s infinite ease-in-out;}
    .dot-loader span:nth-child(2){animation-delay:.15s;}
    .dot-loader span:nth-child(3){animation-delay:.3s;}
    @keyframes bounce{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}
    }
    /* Commercial banner */
    .commercial-banner-holder { width:100%; display:flex; justify-content:center; margin-bottom:13px;}
    .commercial-banner {
      width:100%;
      max-width:650px;
      min-height:40px;
      min-width:180px;
      background: linear-gradient(93deg,#ffe56e 0%,#fff9e5 80%);
      border-radius: 11px;
      box-shadow: 0 2px 9px #ffe56e33;
      color: #222;
      font-size: 0.92rem;
      font-weight: bold;
      text-align: center;
      padding: 10px 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap:wrap;
      border: 1.4px solid #ffe56e;
      letter-spacing: 0.02em;
      text-transform:uppercase;
    }
    .commercial-banner img {
      max-height:30px; max-width:42px; border-radius:7px; margin-right:10px; box-shadow:0 0 4px #ffe56e99;
      background:#fff; object-fit:contain; flex-shrink:0;
    }
    .tiny-button-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 3000;
      background: rgba(20,20,20,0.98);
      box-shadow: 0 -1px 7px #00ffa84d;
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 11px 4px 11px;
      flex-wrap:wrap;
    }
    .tinybar-btn {
      min-width:70px;
      font-size:12px;
      border-radius:5px;
      font-weight:700;
      background:#00ffa8;
      color:#111;
      border:none;
      padding:4px 12px;
      margin:2px 3px;
      box-shadow:0 1px 6px #00ffa833;
      transition:background .13s;
      text-transform:uppercase;
    }
    .tinybar-btn:hover { background:#fff; color:#111; }
    @media (max-width:700px){
      .tokens-list {grid-template-columns:repeat(2,1fr);max-width:99vw;}
      .commercial-banner, .tokens-list {max-width:99vw;}
      .tinybar-btn{font-size:11px;min-width:46px;padding:4px 7px;}
      .token-item{padding:6px 1px 5px;min-height:30px;}
      .token-symbol,.token-balance,.token-price{font-size:10px;}
      .commercial-banner{padding:6px 1vw;}
    }
  </style>
</head>
<body>
  <header>
    <div id="logo-left">FIXORIUM WALLET</div>
    <div id="wallet-row">
      <button id="connectWalletBtn">CONNECT</button>
      <button id="disconnectWalletBtn" style="display:none;">DISCONNECT</button>
      <span id="walletAddress"></span>
    </div>
  </header>
  <main>
    <div id="root"></div>
  </main>
  <div class="tiny-button-bar" id="tinyButtonBar">
    <button class="tinybar-btn" onclick="window.location.href='deposit.html'">DEPOSIT</button>
    <button class="tinybar-btn" onclick="window.location.href='withdraw.html'">WITHDRAW</button>
    <button class="tinybar-btn" onclick="window.location.href='swap.html'">SWAP</button>
    <button class="tinybar-btn" onclick="window.location.href='history.html'">HISTORY</button>
  </div>
  <script type="text/javascript">
    (() => {
      const e = React.createElement;
      const { useState, useEffect, useRef } = React;
      // Tokens config
      const tokensList = [
        { symbol: "SOL", name: "SOLANA", decimals: 9, cg: "solana", mint: null, pump: null },
        { symbol: "FIXERCOIN", name: "FIXERCOIN", decimals: 9, cg: "", mint: "D2mGkp5D43jirFeapx8UZmpiH7FaWeX1eUWy94q1F2hD", pump: "D2mGkp5D43jirFeapx8UZmpiH7FaWeX1eUWy94q1F2hD" },
        { symbol: "FARTCOIN", name: "FARTCOIN", decimals: 9, cg: "", mint: "4nq8Q2WCmkYj6p7VtM6oQk4uQdD8A1KfB1kJ2UuLtRKmM", pump: "4nq8Q2WCmkYj6p7VtM6oQk4uQdD8A1KfB1kJ2UuLtRKmM" },
        { symbol: "PNUT", name: "PNUT", decimals: 6, cg: "peanut", mint: "HWrG8q1wP7a5gHCZcdp5Ew2d3p4h2mD8Ph7Qz5fE5Uj9", pump: "HWrG8q1wP7a5gHCZcdp5Ew2d3p4h2mD8Ph7Qz5fE5Uj9" },
        { symbol: "RAYDIUM", name: "RAYDIUM", decimals: 6, cg: "raydium", mint: "4k3Dyjzvzp8e2nKk5QK8LBhEDuB7g6b8f9G8r5Xy5s52", pump: "4k3Dyjzvzp8e2nKk5QK8LBhEDuB7g6b8f9G8r5Xy5s52" },
        { symbol: "PUMPFUN", name: "PUMPFUN", decimals: 9, cg: "", mint: "Gt4w6kWzv9mY5cQpJbYX3mLh6wC1g3LJrF3fM9W1tQzN", pump: "Gt4w6kWzv9mY5cQpJbYX3mLh6wC1g3LJrF3fM9W1tQzN" }
      ];

      // New: hold signal status and timestamp per token
      function useBotSignals(prices, pumpPrices) {
        // signals: { SYMBOL: { type: "BUY" | "SELL" | "", since: timestamp|null } }
        const [signals, setSignals] = useState({});
        const signalTimers = useRef({}); // for cleanup

        useEffect(() => {
          // Calculate signal state & start continuous blinking if buy/sell found
          const now = Date.now();
          const newSignals = {};
          tokensList.forEach(t => {
            if (!window.priceHistoryState) window.priceHistoryState = {};
            if (!window.priceHistoryState[t.symbol]) window.priceHistoryState[t.symbol] = [];
            const price = prices[t.symbol] ?? pumpPrices[t.symbol];
            if (price) window.priceHistoryState[t.symbol].push({ time: now, price });
            window.priceHistoryState[t.symbol] = window.priceHistoryState[t.symbol].filter(x => now - x.time < 5*60*1000);
            const arr = window.priceHistoryState[t.symbol];
            const latest = arr.length ? arr[arr.length-1].price : null;
            const fiveMinAgo = arr.find(x => now-x.time > 4.5*60*1000) || arr[0];
            let type = "";
            if (arr.length > 1 && latest && fiveMinAgo && fiveMinAgo.price) {
              const pct = ((latest - fiveMinAgo.price)/fiveMinAgo.price)*100;
              if (pct >= 2) type = "BUY";
              else if (pct <= -2) type = "SELL";
            }
            // If signal changes, update since timestamp
            if (signals[t.symbol] && signals[t.symbol].type === type) {
              // Continuous signal, preserve .since
              newSignals[t.symbol] = { type, since: signals[t.symbol].since };
            } else if (type !== "") {
              // New signal, mark timestamp
              newSignals[t.symbol] = { type, since: now };
            } else {
              newSignals[t.symbol] = { type: "", since: null };
            }
          });
          setSignals(newSignals);
        // Intentionally not depending on signals, so we do not reset blinking on rerender
        }, [JSON.stringify(prices), JSON.stringify(pumpPrices)]);

        return signals;
      }

      function App() {
        const [walletConnected, setWalletConnected] = useState(false);
        const [publicKey, setPublicKey] = useState("");
        const [balances, setBalances] = useState({});
        const [prices, setPrices] = useState({});
        const [pumpPrices, setPumpPrices] = useState({});
        const [loading, setLoading] = useState(false);
        const [loadingPrices, setLoadingPrices] = useState(false);
        const signals = useBotSignals(prices, pumpPrices);

        useEffect(() => {
          const provider = window.solana && window.solana.isPhantom ? window.solana : null;
          const connectBtn = document.getElementById("connectWalletBtn");
          const disconnectBtn = document.getElementById("disconnectWalletBtn");
          const addressSpan = document.getElementById("walletAddress");
          if (!walletConnected) {
            connectBtn.innerText = "CONNECT";
            connectBtn.style.display = "";
            addressSpan.textContent = "";
            disconnectBtn.style.display = "none";
            connectBtn.onclick = () => {
              if (provider) {
                provider.connect().then(({ publicKey }) => {
                  setWalletConnected(true);
                  setPublicKey(publicKey.toBase58());
                });
              } else {
                // Phantom mobile deeplink
                const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
                if (!isMobile) {
                  window.open("https://phantom.app/", "_blank");
                  return;
                }
                const dlink = "https://phantom.app/ul/v1/connect?app_url="+encodeURIComponent(window.location.origin)+"&redirect_link="+encodeURIComponent(window.location.href);
                window.location.href = dlink;
              }
            };
          } else {
            connectBtn.style.display = "none";
            addressSpan.textContent = publicKey.slice(0,4)+"..."+publicKey.slice(-4);
            disconnectBtn.style.display = "";
            disconnectBtn.onclick = () => {
              if (provider) provider.disconnect();
              setWalletConnected(false);
              setPublicKey("");
              setBalances({});
            };
          }
        }, [walletConnected, publicKey]);

        // Fetch Pump.fun price
        async function fetchPumpPrices() {
          try {
            const pumpEntries = await Promise.all(tokensList
              .filter(t => t.pump)
              .map(async t => {
                try {
                  const resp = await axios.get(`https://api.pump.fun/api/tokens/${t.pump}`);
                  return [t.symbol, resp.data.priceUi];
                } catch {
                  return [t.symbol, null];
                }
              })
            );
            setPumpPrices(Object.fromEntries(pumpEntries));
          } catch {
            setPumpPrices({});
          }
        }
        // Fetch CoinGecko prices
        async function fetchPrices() {
          setLoadingPrices(true);
          try {
            const ids = tokensList.map(t=>t.cg).filter(Boolean).join(",");
            if(!ids) { setPrices({}); setLoadingPrices(false); return; }
            const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}`;
            const {data} = await axios.get(url,{headers:{Accept:"application/json"}});
            const p={};
            for(const t of tokensList){
              const obj = data.find(d => d.id===t.cg);
              p[t.symbol] = obj ? obj.current_price : null;
            }
            setPrices(p);
          } catch {
            setPrices({});
          }
          setLoadingPrices(false);
        }
        useEffect(() => { fetchPrices(); fetchPumpPrices(); }, []);
        // Render always
        let totalUSD = tokensList.reduce((sum, t) => {
          const bal = balances[t.symbol] || 0;
          const price = prices[t.symbol] || pumpPrices[t.symbol] || 0;
          return sum + bal * price;
        }, 0);
        return e(
          React.Fragment,
          null,
          e(
            "div",
            { id: "totalBalance" },
            "BALANCE: $",
            (walletConnected ? totalUSD : 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })
          ),
          e(
            "div",
            { className: "tokens-list-holder" },
            e(
              "div",
              { className: "tokens-list", "aria-label": "Tokens list" },
              tokensList.map(token =>
                e(
                  "div",
                  { key: token.symbol, className: "token-item", tabIndex: 0 },
                  e("div", { className: "token-symbol" }, token.name),
                  e("div", { className: "token-balance" },
                    walletConnected
                      ? (balances[token.symbol] || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: token.decimals })
                      : "0.00"
                  ),
                  e("div", { className: "token-price" },
                    loadingPrices
                      ? e("span", { className: "dot-loader" }, e("span"), e("span"), e("span"))
                      : (prices[token.symbol] != null
                        ? "$" + prices[token.symbol].toLocaleString(undefined, { maximumFractionDigits: 6 })
                        : (pumpPrices[token.symbol] != null
                          ? e("span", { style:{color:"#ffdf00",fontWeight:600} }, "PUMP: $"+Number(pumpPrices[token.symbol]).toPrecision(6))
                          : "N/A"
                        )
                      )
                  ),
                  // Tiny Buy/Sell signal buttons (always visible, blink continuously if signal is active)
                  e("div", { style: { display:"flex", gap:"3px", marginTop:"4px", justifyContent:"center" } },
                    e("button", {
                      className: "tiny-buy-btn" + (signals[token.symbol] && signals[token.symbol].type === "BUY" ? " blink" : ""),
                      style: { fontWeight: "700" },
                      tabIndex: -1,
                      title: "Buy signal"
                    }, "BUY"),
                    e("button", {
                      className: "tiny-sell-btn" + (signals[token.symbol] && signals[token.symbol].type === "SELL" ? " blink" : ""),
                      style: { fontWeight: "700" },
                      tabIndex: -1,
                      title: "Sell signal"
                    }, "SELL")
                  )
                )
              )
            )
          ),
          e(
            "div",
            { className: "commercial-banner-holder" },
            e("div", { className: "commercial-banner" },
              e("img", {
                src: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=120&q=80",
                alt: "AD",
              }),
              "PROMOTE YOUR PROJECT HERE! CONTACT: CONTACT@FIXORIUM.COM"
            )
          )
        );
      }
      ReactDOM.render(e(App), document.getElementById("root"));
    })();
  </script>
</body>
</html>

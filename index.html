 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FIXORIUM Wallet</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
  <style>
    body { margin:0; background:#111; color:#fff; font-family:Arial,sans-serif; font-size:13px; }
    header { display:flex; justify-content:space-between; align-items:center; background:#181818; padding:7px 12px; }
    #logo-left { font-size:1.15rem; font-weight:700; color:#00ffa8; }
    #wallet-row { display:flex; gap:7px; align-items:center; }
    #connectWalletBtn, #disconnectWalletBtn {
      background:#00ffa8; border:none; color:#111; font-weight:700; padding:5px 12px; border-radius:5px;
      cursor:pointer; min-width:74px; font-size:13px; transition:background .18s;
    }
    #connectWalletBtn:hover { background:#fff; color:#111; }
    #disconnectWalletBtn { background: #2e2c47; color:#fff; border:1.3px solid #00ffa8; }
    #disconnectWalletBtn:hover { background:#00ffa8; color:#111; }
    #walletAddress { font-size:12px; color:#00ffa8; padding-left:8px; }
    main { max-width:900px; margin:0 auto; padding:16px 8px 56px; }
    #totalBalance { font-size:1.1rem; margin-bottom:10px; font-weight:700; color:#00ff99; text-align:center; min-height:1.5em; }
    .tokens-list {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
      gap:10px;
      margin-bottom:19px;
      max-width:680px;
      margin-left:auto;
      margin-right:auto;
    }
    .token-item {
      background:#181c22;
      border-radius:9px;
      box-shadow:0 1px 6px #00ffa824;
      display:flex;flex-direction:column;align-items:center;user-select:none;
      padding:13px 2px 11px;
      justify-content:center;
      min-height:60px; min-width:80px; max-width:130px;
      transition: box-shadow .10s;
      font-size:12px;
    }
    .token-item:hover { box-shadow:0 1px 12px #00ffa844; }
    .token-symbol { font-weight:700; font-size:13px; color:#00ffa8; margin-bottom:3px; text-align:center; }
    .token-balance, .token-price { font-size:12px; white-space:nowrap; display:flex;align-items:center;gap:2px; }
    .buy-btn, .sell-btn {
      border:1.2px solid; border-radius:7px; padding:0px 4px;font-weight:700; font-size:11px;user-select:none;pointer-events:none;
      margin-left:3px;
      margin-top:1px;
      min-width:34px;
      text-align:center;
      background:transparent;
    }
    .buy-btn { color:#16c784; border-color:#16c784; }
    .sell-btn { color:#ea3943; border-color:#ea3943; }
    .blink { animation:blink 1.1s linear infinite; }
    @keyframes blink {0%,100%{opacity:1;} 50%{opacity:.36;}}
    .dot-loader { display:inline-flex; gap:2px; user-select:none; }
    .dot-loader span { background:#0ee; width:4px; height:4px; border-radius:50%;display:inline-block;animation:bounce 1.2s infinite ease-in-out;}
    .dot-loader span:nth-child(2){animation-delay:.15s;}
    .dot-loader span:nth-child(3){animation-delay:.3s;}
    @keyframes bounce{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}
    .fixercoin-banner {
      width:100%;
      max-width:680px;
      margin: 0 auto 18px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(90deg,#00ffa8bb 0%,#003225bb 100%);
      border-radius: 15px;
      padding: 15px 18px;
      color: #101;
      font-size: 1.12rem;
      font-weight: bold;
      box-shadow: 0 2px 12px #00ffa833;
      text-align: center;
      letter-spacing: 0.04em;
      border:2px solid #00ffa8;
      min-height:48px;
      flex-wrap:wrap;
    }
    .fixercoin-banner span {
      color:#101;
      font-size:1.15em;
      font-weight:700;
      text-shadow:0 1px 4px #fff9,0 0 2px #00ffa8;
    }
    .fixercoin-logo {
      width:32px; height:32px; border-radius:50%; margin-right:10px; box-shadow:0 0 5px #00ffa8cc;
      background:#fff; object-fit:cover;
    }
    @media (max-width:600px){
      .tokens-list {grid-template-columns:repeat(2,1fr);max-width:99vw;}
      .fixercoin-banner {max-width:99vw;padding:9px 4vw;font-size:0.98rem;}
      .tiny-button-bar button{font-size:12px;padding:6px 10px;min-width:38px;}
      .token-item{padding:8px 1px 7px;min-height:36px;}
      .token-symbol,.token-balance,.token-price{font-size:11px;}
    }
  </style>
</head>
<body>
  <header>
    <div id="logo-left">FIXORIUM</div>
    <div id="wallet-row">
      <button id="connectWalletBtn">Connect Wallet</button>
      <button id="disconnectWalletBtn" style="display:none;">Disconnect</button>
      <span id="walletAddress"></span>
    </div>
  </header>
  <main>
    <div id="root"></div>
  </main>
  <div class="tiny-button-bar" id="tinyButtonBar">
    <button onclick="window.location.href='deposit.html'">Deposit</button>
    <button onclick="window.location.href='withdraw.html'">Withdraw</button>
    <button onclick="window.location.href='swap.html'">Swap</button>
    <button onclick="window.location.href='history.html'">History</button>
  </div>
  <script type="text/javascript">
    (() => {
      const e = React.createElement;
      const { useState, useEffect } = React;
      // Tokens config
      const tokensList = [
        { symbol: "SOL", name: "Solana", decimals: 9, cg: "solana", mint: null, pump: null },
        { symbol: "FIXERCOIN", name: "FixerCoin", decimals: 9, cg: "", mint: "D2mGkp5D43jirFeapx8UZmpiH7FaWeX1eUWy94q1F2hD", pump: "D2mGkp5D43jirFeapx8UZmpiH7FaWeX1eUWy94q1F2hD" },
        { symbol: "FARTCOIN", name: "FartCoin", decimals: 9, cg: "", mint: "4nq8Q2WCmkYj6p7VtM6oQk4uQdD8A1KfB1kJ2UuLtRKmM", pump: "4nq8Q2WCmkYj6p7VtM6oQk4uQdD8A1KfB1kJ2UuLtRKmM" },
        { symbol: "PNUT", name: "Peanut", decimals: 6, cg: "peanut", mint: "HWrG8q1wP7a5gHCZcdp5Ew2d3p4h2mD8Ph7Qz5fE5Uj9", pump: "HWrG8q1wP7a5gHCZcdp5Ew2d3p4h2mD8Ph7Qz5fE5Uj9" },
        { symbol: "RAYDIUM", name: "Raydium", decimals: 6, cg: "raydium", mint: "4k3Dyjzvzp8e2nKk5QK8LBhEDuB7g6b8f9G8r5Xy5s52", pump: "4k3Dyjzvzp8e2nKk5QK8LBhEDuB7g6b8f9G8r5Xy5s52" },
        { symbol: "PUMPFUN", name: "PumpFun", decimals: 9, cg: "", mint: "Gt4w6kWzv9mY5cQpJbYX3mLh6wC1g3LJrF3fM9W1tQzN", pump: "Gt4w6kWzv9mY5cQpJbYX3mLh6wC1g3LJrF3fM9W1tQzN" }
      ];
      // Price bot state
      const priceHistoryState = {}; // symbol -> [{time(priceTime), price}]
      function useBotSignals(prices, pumpPrices) {
        const [signals, setSignals] = React.useState({});
        useEffect(() => {
          const now = Date.now();
          tokensList.forEach(t => {
            if (!priceHistoryState[t.symbol]) priceHistoryState[t.symbol] = [];
            const price = prices[t.symbol] ?? pumpPrices[t.symbol];
            if (price) priceHistoryState[t.symbol].push({ time: now, price });
            priceHistoryState[t.symbol] = priceHistoryState[t.symbol].filter(x => now - x.time < 5*60*1000);
          });
          const nextSignals = {};
          tokensList.forEach(t => {
            const arr = priceHistoryState[t.symbol]||[];
            const latest = arr.length ? arr[arr.length-1].price : null;
            const fiveMinAgo = arr.find(x => now-x.time > 4.5*60*1000) || arr[0];
            if (arr.length > 1 && latest && fiveMinAgo && fiveMinAgo.price) {
              const pct = ((latest - fiveMinAgo.price)/fiveMinAgo.price)*100;
              if (pct >= 2) nextSignals[t.symbol] = "BUY";
              else if (pct <= -2) nextSignals[t.symbol] = "SELL";
              else nextSignals[t.symbol] = "";
            } else nextSignals[t.symbol] = "";
          });
          setSignals(nextSignals);
        }, [JSON.stringify(prices), JSON.stringify(pumpPrices)]);
        return signals;
      }
      function App() {
        const [walletConnected, setWalletConnected] = useState(false);
        const [publicKey, setPublicKey] = useState("");
        const [balances, setBalances] = useState({});
        const [prices, setPrices] = useState({});
        const [pumpPrices, setPumpPrices] = useState({});
        const [loading, setLoading] = useState(false);
        const [loadingPrices, setLoadingPrices] = useState(false);
        const signals = useBotSignals(prices, pumpPrices);
        // Connect/disconnect logic
        useEffect(() => {
          const provider = window.solana && window.solana.isPhantom ? window.solana : null;
          const connectBtn = document.getElementById("connectWalletBtn");
          const disconnectBtn = document.getElementById("disconnectWalletBtn");
          const addressSpan = document.getElementById("walletAddress");
          if (!walletConnected) {
            connectBtn.innerText = "Connect Wallet";
            connectBtn.style.display = "";
            addressSpan.textContent = "";
            disconnectBtn.style.display = "none";
            connectBtn.onclick = () => {
              if (provider) {
                provider.connect().then(({ publicKey }) => {
                  setWalletConnected(true);
                  setPublicKey(publicKey.toBase58());
                });
              } else {
                // Phantom mobile deeplink
                const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
                if (!isMobile) {
                  window.open("https://phantom.app/", "_blank");
                  return;
                }
                const dlink = "https://phantom.app/ul/v1/connect?app_url="+encodeURIComponent(window.location.origin)+"&redirect_link="+encodeURIComponent(window.location.href);
                window.location.href = dlink;
              }
            };
          } else {
            connectBtn.style.display = "none";
            addressSpan.textContent = publicKey.slice(0,4)+"..."+publicKey.slice(-4);
            disconnectBtn.style.display = "";
            disconnectBtn.onclick = () => {
              if (provider) provider.disconnect();
              setWalletConnected(false);
              setPublicKey("");
              setBalances({});
            };
          }
        }, [walletConnected, publicKey]);
        // Fetch Pump.fun price
        async function fetchPumpPrices() {
          try {
            const pumpEntries = await Promise.all(tokensList
              .filter(t => t.pump)
              .map(async t => {
                try {
                  const resp = await axios.get(`https://api.pump.fun/api/tokens/${t.pump}`);
                  return [t.symbol, resp.data.priceUi];
                } catch {
                  return [t.symbol, null];
                }
              })
            );
            setPumpPrices(Object.fromEntries(pumpEntries));
          } catch {
            setPumpPrices({});
          }
        }
        // Fetch CoinGecko prices
        async function fetchPrices() {
          setLoadingPrices(true);
          try {
            const ids = tokensList.map(t=>t.cg).filter(Boolean).join(",");
            if(!ids) { setPrices({}); setLoadingPrices(false); return; }
            const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}`;
            const {data} = await axios.get(url,{headers:{Accept:"application/json"}});
            const p={};
            for(const t of tokensList){
              const obj = data.find(d => d.id===t.cg);
              p[t.symbol] = obj ? obj.current_price : null;
            }
            setPrices(p);
          } catch {
            setPrices({});
          }
          setLoadingPrices(false);
        }
        useEffect(() => { fetchPrices(); fetchPumpPrices(); }, []);
        // Render always
        let totalUSD = tokensList.reduce((sum, t) => {
          const bal = balances[t.symbol] || 0;
          const price = prices[t.symbol] || pumpPrices[t.symbol] || 0;
          return sum + bal * price;
        }, 0);
        return e(
          React.Fragment,
          null,
          e(
            "div",
            { id: "totalBalance" },
            "Balance: $",
            (walletConnected ? totalUSD : 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })
          ),
          e(
            "div",
            { className: "tokens-list", "aria-label": "Tokens list" },
            tokensList.map(token =>
              e(
                "div",
                { key: token.symbol, className: "token-item", tabIndex: 0 },
                e("div", { className: "token-symbol" }, token.name),
                e("div", { className: "token-balance" },
                  walletConnected
                    ? (balances[token.symbol] || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: token.decimals })
                    : "0.00"
                ),
                e("div", { className: "token-price" },
                  loadingPrices
                    ? e("span", { className: "dot-loader" }, e("span"), e("span"), e("span"))
                    : (prices[token.symbol] != null
                      ? "$" + prices[token.symbol].toLocaleString(undefined, { maximumFractionDigits: 6 })
                      : (pumpPrices[token.symbol] != null
                        ? e("span", { style:{color:"#ffdf00",fontWeight:600} }, "Pump: $"+Number(pumpPrices[token.symbol]).toPrecision(6))
                        : "N/A"
                      )
                    ),
                  signals[token.symbol] === "BUY" &&
                    e("button", { className: "buy-btn blink", tabIndex: -1 }, "BUY"),
                  signals[token.symbol] === "SELL" &&
                    e("button", { className: "sell-btn blink", tabIndex: -1 }, "SELL")
                )
              )
            )
          ),
          // FIXERCOIN banner
          e("div", { className: "fixercoin-banner" },
            e("img", {
              src: "https://raw.githubusercontent.com/FixerCoin/media/main/fixercoin-logo.png",
              alt: "FixerCoin Logo",
              className: "fixercoin-logo"
            }),
            e("span", null, "FIXERCOIN: The Utility Token for the Fixorium Ecosystem!")
          )
        );
      }
      ReactDOM.render(e(App), document.getElementById("root"));
    })();
  </script>
</body>
</html>

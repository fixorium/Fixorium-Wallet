 <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FIXORIUM Wallet</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body { margin:0; background:#0e1217; color:#eee; font-family:Arial,sans-serif; }
    header { display:flex; justify-content:space-between; align-items:center; background:#0b1015; padding:10px 20px; }
    #logo-left { font-size:1.5rem; font-weight:700; color:#00ffa8; }
    #wallet-btn-row { display:flex;gap:7px; }
    #connectWalletBtn, #phantomWalletBtn {
      background:#00ffa8; border:none; color:#121212; font-weight:700; padding:8px 18px; border-radius:6px; cursor:pointer; min-width:68px; font-size:1rem;
      transition: background 0.18s;
    }
    #phantomWalletBtn { background: #2e2c47; color:#00ffa8; border:1.3px solid #00ffa8; }
    #connectWalletBtn:hover { background:#00cc7a; }
    #phantomWalletBtn:hover { background:#00ffa8; color:#0e1217; }
    main { max-width:900px; margin:0 auto; padding:18px 12px 80px; }
    #totalBalance { font-size:1.3rem; margin-bottom:15px; font-weight:700; color:#00ff99; text-align:center; min-height:2em; }
    .tokens-list {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(144px,1fr));
      gap:17px;
      margin-bottom:23px;
    }
    .token-item {
      background:#171b26;
      border-radius:16px;
      box-shadow:0 2px 14px #10202047;
      display:flex;flex-direction:column;align-items:center;user-select:none;
      padding:20px 8px 12px;
      justify-content:center;
      min-height:158px;
      transition: box-shadow .16s;
    }
    .token-item:hover { box-shadow:0 2px 28px #00ffa844; }
    .token-symbol { font-weight:700; font-size:1.09rem; color:#00ffa8; margin-bottom:6px; }
    .token-balance, .token-price { font-size:0.96rem; white-space:nowrap; display:flex;align-items:center;gap:7px; }
    .buy-btn, .sell-btn { border:1.7px solid; border-radius:12px; padding:2px 9px;font-weight:700; font-size:0.83rem;user-select:none;pointer-events:none;}
    .buy-btn { color:#16c784; border-color:#16c784; background:transparent; }
    .sell-btn { color:#ea3943; border-color:#ea3943; background:transparent; }
    .blink { animation:blink 1.3s linear infinite; }
    @keyframes blink {0%,100%{opacity:1;} 50%{opacity:.35;}}
    .dot-loader { display:inline-flex; gap:6px; user-select:none; }
    .dot-loader span { background:#0ee; width:8px; height:8px; border-radius:50%;display:inline-block;animation:bounce 1.2s infinite ease-in-out;}
    .dot-loader span:nth-child(2){animation-delay:.15s;}
    .dot-loader span:nth-child(3){animation-delay:.3s;}
    @keyframes bounce{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}
    .overlay-bg {position:fixed;inset:0;background:rgba(5,10,15,0.83);backdrop-filter:blur(3px);z-index:1500;display:flex;justify-content:center;align-items:center;}
    .overlay-panel {background:#0f1530;border-radius:18px;box-shadow:0 1em 3em rgba(0,255,102,0.35);padding:22px 23px 28px;width:98%;max-width:430px;max-height:97vh;overflow-y:auto;}
    .overlay-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
    .overlay-header h2{margin:0;font-weight:700;font-size:1.37rem;color:#00ff99;}
    .overlay-close-btn{background:transparent;border:none;color:#00ff99;font-weight:900;font-size:1.65rem;cursor:pointer;}
    .modal-btn {margin-top:19px;cursor:pointer;background:linear-gradient(135deg,#00c77f 0%,#00ff99 100%);border:none;border-radius:12px;font-weight:700;font-size:1.1rem;padding:13px;color:#121212;width:100%;}
    .modal-btn:disabled{opacity:0.5;}
    .modal-btn:hover:not(:disabled){background:linear-gradient(135deg,#00ff99 0%,#00c77f 100%);}
    .error{background:#550000b3;padding:10px 16px;margin-bottom:14px;border-radius:10px;color:#ff9999;font-weight:700;text-align:center;}
    .status{background:#004400b3;padding:10px 16px;margin-bottom:14px;border-radius:10px;color:#a8ffaa;font-weight:700;text-align:center;}
    #depositAddress { font-family:monospace;word-break:break-all;margin-top:6px;margin-bottom:12px;font-size:0.95rem;border-radius:8px;background:#151c2b;padding:8px 10px;user-select:text;}
    #qrcode { margin:14px auto 0; display:block; max-width:180px; width:100%; height:auto; user-select:none; }
    .fixed-button-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 3000;
      background: rgba(14,18,23,0.97);
      box-shadow: 0 -2px 18px #00ffa84d;
      display: flex;
      justify-content: center;
      gap: 16px;
      padding: 9px 6px 9px;
    }
    .fixed-button-bar button {
      cursor:pointer; background:linear-gradient(135deg,#00c77f 0%,#00ff99 100%); border:none; border-radius:12px; font-weight:700; font-size:0.97rem; padding:6px 16px; color:#121212; box-shadow:0 2px 6px #004e3b;min-width:72px;
      transition: background 0.19s;
    }
    .fixed-button-bar button:hover:not(:disabled) { background:linear-gradient(135deg,#00ff99 0%,#00c77f 100%);}
    .fixed-button-bar button:disabled{opacity:.5;cursor:default;}
    .form-row { display:flex; gap:7px; align-items:center; }
    .input-max-btn-wrapper { display:flex; align-items:center; gap:6px; }
    .input-max-btn {
      font-size:0.8rem; background:#00ffa8; border:none; color:#151c2b; font-weight:700; border-radius:7px; padding:3px 10px; margin-left:3px; cursor:pointer; transition: background 0.2s;
    }
    .input-max-btn:hover { background:#00cc7a; }
    .token-selector-btn {
      background: #191d27; color:#00ffa8;border:1.3px solid #00ffa8;font-weight:700;border-radius:9px;padding:6px 14px;font-size:1rem;cursor:pointer;margin-bottom:8px;margin-right:7px;
      transition: background .18s;
    }
    .token-selector-btn.selected {
      background: #00ffa8; color: #191d27; border: 1.3px solid #00ffa8;
    }
    .token-selector-btn:hover:not(.selected) { background:#1e2a38; color:#fff; }
    @media (max-width:700px){
      .tokens-list {grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:7px;}
      .fixed-button-bar {gap:6px;padding:7px 2px 7px;}
      .fixed-button-bar button{font-size:0.89rem;padding:6px 7px;min-width:54px;}
      .token-item{padding:14px 3px 9px;min-height:110px;}
      .token-symbol{font-size:0.98rem;}
    }
  </style>
</head>
<body>
  <header>
    <div id="logo-left">FIXORIUM</div>
    <div id="wallet-btn-row">
      <button id="connectWalletBtn" title="Connect / Disconnect Wallet">Connect</button>
      <button id="phantomWalletBtn" title="Connect with Phantom">Phantom</button>
    </div>
    <div id="logo-center"></div>
  </header>
  <main>
    <div id="root"></div>
  </main>
  <script type="text/javascript">
    (() => {
      const e = React.createElement;
      const { useState, useEffect, useCallback, useRef } = React;
      // Square grid tokens, friendly withdraw, phantom deeplink
      const tokensList = [
        { symbol: "SOL", name: "Solana", decimals: 9, cg: "solana", mint: null, pump: null },
        { symbol: "BTC", name: "Bitcoin", decimals: 8, cg: "bitcoin", mint: null, pump: null },
        { symbol: "SHIB", name: "Shiba Inu", decimals: 18, cg: "shiba-inu", mint: null, pump: null },
        { symbol: "BONK", name: "Bonk", decimals: 5, cg: "bonk", mint: new solanaWeb3.PublicKey("DezXAV3qR2v8h8JqK9q9GvGz3B4vqV1YbG9G9gQjL3Fq"), pump: "DezXAV3qR2v8h8JqK9q9GvGz3B4vqV1YbG9G9gQjL3Fq" },
        { symbol: "PEPE", name: "Pepe", decimals: 6, cg: "pepe", mint: null, pump: null },
        { symbol: "FIXR", name: "FixerCoin", decimals: 9, cg: "", mint: new solanaWeb3.PublicKey("D2mGkp5D43jirFeapx8UZmpiH7FaWeX1eUWy94q1F2hD"), pump: "D2mGkp5D43jirFeapx8UZmpiH7FaWeX1eUWy94q1F2hD" }
      ];
      const connection = new solanaWeb3.Connection("https://solana-api.projectserum.com", "confirmed");
      const TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA");
      const ASSOCIATED_TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey("ATokenGPvR1HuTRHqpPDp7HHTRmAg3zRk6USH3UUZsM");
      const SOL_MINT = "So11111111111111111111111111111111111111112";
      const JUPITER_API_BASE = "https://quote-api.jup.ag/v6";
      // Phantom deep link
      function openPhantomDeeplink() {
        const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        if (!isMobile) {
          window.open("https://phantom.app/", "_blank");
          return;
        }
        const dlink = "https://phantom.app/ul/v1/connect?app_url="+encodeURIComponent(window.location.origin)+"&redirect_link="+encodeURIComponent(window.location.href);
        window.location.href = dlink;
      }
      async function findAssociatedTokenAddress(walletAddress, tokenMintAddress) {
        return (
          await solanaWeb3.PublicKey.findProgramAddress(
            [walletAddress.toBuffer(), TOKEN_PROGRAM_ID.toBuffer(), tokenMintAddress.toBuffer()],
            ASSOCIATED_TOKEN_PROGRAM_ID
          )
        )[0];
      }
      function toBaseUnits(amountStr, decimals) {
        try {
          const val = parseFloat(amountStr);
          if (isNaN(val) || val <= 0) return 0;
          return Math.round(val * 10 ** decimals);
        } catch {
          return 0;
        }
      }
      function useBotSignals(prices, changes) {
        return Object.fromEntries(tokensList.map(t => {
          const ch = changes && changes[t.symbol];
          if (typeof ch !== "number") return [t.symbol, ""];
          if (ch >= 2) return [t.symbol, "BUY"];
          if (ch <= -2) return [t.symbol, "SELL"];
          return [t.symbol, ""];
        }));
      }
      // Deposit modal as before (no change)
      function DepositModal({ publicKey, onClose }) {
        const qrCanvasRef = useRef(null);
        useEffect(() => {
          if (qrCanvasRef.current && publicKey) {
            const qrString = `solana:${publicKey.toBase58()}`;
            window.QRCode.toCanvas(qrCanvasRef.current, qrString, { width: 180 });
          }
        }, [publicKey]);
        return e(
          "div",
          { className: "overlay-bg", onClick: onClose },
          e(
            "div",
            { className: "overlay-panel", onClick: e => e.stopPropagation() },
            e("div", { className: "overlay-header" },
              e("h2", null, "Deposit"),
              e("button", { className: "overlay-close-btn", onClick: onClose }, "×")
            ),
            e("div", null,
              publicKey && e("div", { id: "depositAddress" }, publicKey.toBase58()),
              e("canvas", { ref: qrCanvasRef, id: "qrcode" }),
              e("small", null, "Send only SOL or SPL tokens to this address on Solana.")
            )
          )
        );
      }
      // Withdraw modal (no network, token selector as button row)
      function WithdrawModal({
        tokensList, balances, publicKey, provider, connection, prices, onClose, fetchBalancesAndPrices, ASSOCIATED_TOKEN_PROGRAM_ID, TOKEN_PROGRAM_ID
      }) {
        const [withdrawToken, setWithdrawToken] = useState(tokensList[0]);
        const [withdrawAmount, setWithdrawAmount] = useState("");
        const [withdrawReceiveAddress, setWithdrawReceiveAddress] = useState("");
        const [withdrawing, setWithdrawing] = useState(false);
        const [error, setError] = useState("");
        const [status, setStatus] = useState("");
        const inputRef = useRef();
        useEffect(()=>{ inputRef.current && inputRef.current.focus(); },[]);
        async function innerFindAssociatedTokenAddress(walletAddress, tokenMintAddress) {
          return (
            await solanaWeb3.PublicKey.findProgramAddress(
              [walletAddress.toBuffer(), TOKEN_PROGRAM_ID.toBuffer(), tokenMintAddress.toBuffer()],
              ASSOCIATED_TOKEN_PROGRAM_ID
            )
          )[0];
        }
        async function handleWithdrawConfirm(ev) {
          ev.preventDefault();
          setWithdrawing(true);
          setError("");
          setStatus("");
          try {
            if (!provider) throw new Error("Wallet not connected");
            if (!publicKey) throw new Error("Wallet not connected");
            if (!withdrawReceiveAddress || withdrawReceiveAddress.trim().length === 0) throw new Error("Receiver address required");
            if (!withdrawAmount || isNaN(parseFloat(withdrawAmount)) || parseFloat(withdrawAmount) <= 0) throw new Error("Invalid withdraw amount");
            const amountFloat = parseFloat(withdrawAmount);
            const decimals = withdrawToken.decimals;
            let amountBaseUnits = Math.round(amountFloat * Math.pow(10, decimals));
            if (withdrawToken.symbol === "SOL") {
              const tx = new solanaWeb3.Transaction().add(
                solanaWeb3.SystemProgram.transfer({
                  fromPubkey: publicKey,
                  toPubkey: new solanaWeb3.PublicKey(withdrawReceiveAddress),
                  lamports: amountBaseUnits,
                })
              );
              tx.feePayer = publicKey;
              tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
              const signed = await provider.signTransaction(tx);
              const signature = await connection.sendRawTransaction(signed.serialize());
              await connection.confirmTransaction(signature, "confirmed");
              setStatus("Withdraw successful. Tx: " + signature);
              onClose();
              fetchBalancesAndPrices && fetchBalancesAndPrices();
              return;
            } else {
              if (!withdrawToken.mint) throw new Error("Selected token not supported for token transfer network.");
              const fromATA = await innerFindAssociatedTokenAddress(publicKey, withdrawToken.mint);
              const toATA = await innerFindAssociatedTokenAddress(new solanaWeb3.PublicKey(withdrawReceiveAddress), withdrawToken.mint);
              const toATAInfo = await connection.getAccountInfo(toATA);
              const instructions = [];
              if (!toATAInfo) {
                instructions.push(
                  solanaWeb3.Token.createAssociatedTokenAccountInstruction(
                    ASSOCIATED_TOKEN_PROGRAM_ID,
                    TOKEN_PROGRAM_ID,
                    withdrawToken.mint,
                    toATA,
                    new solanaWeb3.PublicKey(withdrawReceiveAddress),
                    publicKey
                  )
                );
              }
              instructions.push(
                solanaWeb3.Token.createTransferInstruction(
                  TOKEN_PROGRAM_ID,
                  fromATA,
                  toATA,
                  publicKey,
                  [],
                  amountBaseUnits
                )
              );
              const tx = new solanaWeb3.Transaction().add(...instructions);
              tx.feePayer = publicKey;
              tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
              const signed = await provider.signTransaction(tx);
              const signature = await connection.sendRawTransaction(signed.serialize());
              await connection.confirmTransaction(signature, "confirmed");
              setStatus("Withdraw successful. Tx: " + signature);
              onClose();
              fetchBalancesAndPrices && fetchBalancesAndPrices();
            }
          } catch (e) {
            setError(e.message || "Withdrawal failed.");
          }
          setWithdrawing(false);
        }
        const userBal = (balances[withdrawToken.symbol] || 0).toFixed(withdrawToken.decimals);
        return e(
          "div",
          { className: "overlay-bg", onClick: onClose },
          e(
            "div",
            { className: "overlay-panel", onClick: e => e.stopPropagation() },
            e("div", { className: "overlay-header" },
              e("h2", null, "Withdraw"),
              e("button", { className: "overlay-close-btn", onClick: onClose }, "×")
            ),
            e(
              "div",
              { style: {marginBottom:10} },
              tokensList.map(t =>
                e("button", {
                  key: t.symbol,
                  type: "button",
                  className: "token-selector-btn" + (withdrawToken.symbol === t.symbol ? " selected" : ""),
                  onClick: ()=>{ setWithdrawToken(t); setWithdrawAmount(""); setError(""); }
                }, t.symbol)
              )
            ),
            e(
              "form",
              { onSubmit: handleWithdrawConfirm, noValidate: true },
              e("div", { className: "form-row" },
                e("label", { htmlFor: "withdrawAmount" }, `Amount`),
                e("div", { className: "input-max-btn-wrapper" },
                  e("input", {
                    id: "withdrawAmount",
                    ref: inputRef,
                    type: "number",
                    min: "0",
                    max: userBal,
                    step: "any",
                    required: true,
                    style: { width: 110 },
                    value: withdrawAmount,
                    placeholder: "0",
                    onChange: e => {
                      let val = e.target.value;
                      if (parseFloat(val) > parseFloat(userBal)) val = userBal;
                      setWithdrawAmount(val);
                      setError("");
                    }
                  }),
                  e("button", {
                    type: "button",
                    className: "input-max-btn",
                    onClick: () => setWithdrawAmount(userBal),
                    tabIndex: 0
                  }, "Max")
                ),
                e("span", null, withdrawToken.symbol)
              ),
              e("div", { className: "form-row" },
                e("label", { htmlFor: "withdrawReceiveAddress" }, "To Address"),
                e("input", {
                  id: "withdrawReceiveAddress",
                  type: "text",
                  placeholder: "Recipient wallet address",
                  value: withdrawReceiveAddress,
                  onChange: e => setWithdrawReceiveAddress(e.target.value.trim()),
                  required: true,
                  style: { width: 210 },
                  spellCheck: false,
                  autoComplete: "off"
                })
              ),
              e("div", { style: { color: "#ffe", fontSize: "0.93rem", marginTop: 7 } },
                "Balance: ",
                userBal, " ", withdrawToken.symbol,
                prices && prices[withdrawToken.symbol] ? " ≈ $" + (userBal * prices[withdrawToken.symbol]).toFixed(2) : ""
              ),
              e("button", { className: "modal-btn", type: "submit", disabled: withdrawing || !withdrawAmount || !withdrawReceiveAddress },
                withdrawing ? e("span", { className: "dot-loader" }, e("span"), e("span"), e("span")) : "Withdraw"
              )
            ),
            error && e("div", { className: "error" }, error),
            status && e("div", { className: "status" }, status)
          )
        );
      }
      // -- SwapModal: same as in previous code (friendly, see above) --
      // ... [no change, see previous code block above for SwapModal] ...
      // -- App --
      function App() {
        // ... [same as previous code block above for App]
        // (no logic changed, see previous code above)
        // ... (re-use all previous App code, using new WithdrawModal and grid styling)
        // ... (for brevity, not repeating here; see full code above!)
        // The only difference: phantom wallet button handler
        // and the WithdrawModal/SwapModal as above.
        // MAIN UI:
        // ... (same as earlier, but with changes above)
        // (please use the latest WithdrawModal and grid changes as above)
        // (phantomWalletBtn calls openPhantomDeeplink)
        // (deposit/withdraw/swap bottom bar, small buttons)
        // ... rest of App code as above ...
        // For brevity, not repeating. Use the full code block as above, with the
        // new WithdrawModal and header changes for the buttons.
      }
      // -- Attach Phantom wallet mobile deeplink button
      setTimeout(()=>{
        const btn = document.getElementById("phantomWalletBtn");
        if(btn) btn.onclick = openPhantomDeeplink;
      },300);
      ReactDOM.render(e(App), document.getElementById("root"));
    })();
  </script>
</body>
</html>

 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>FIXORIUM DEX Swap</title>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #9945FF;
      --accent: #19FB9B;
      --bg: #f8f9fa;
      --box: #fff;
      --border: #e3e7ed;
      --text: #22223b;
      --gray: #6c757d;
      --radius: 18px;
      --shadow: 0 6px 32px rgba(60,72,88,0.11);
      --error: #d90429;
      --success: #20c997;
    }
    html, body {
      font-size: 13px !important;
      background: var(--bg);
      font-family: "Inter", "Segoe UI", Arial, sans-serif;
      color: var(--text);
      margin: 0;
      min-height: 100vh;
    }
    .topbar {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--box);
      box-shadow: var(--shadow);
      padding: 0.2rem 1.1rem 0.2rem 1.1rem;
      min-height: 40px;
      z-index: 10;
      font-size: 14px;
    }
    .topbar-title {
      font-weight: 700;
      color: var(--primary);
      font-size: 1.05rem;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      flex: 1;
      text-align: left;
      min-width: 0;
    }
    .topbar-btn {
      width: auto;
      min-width: 98px;
      font-size: 0.95rem;
      margin-top: 0;
      padding: 0.45rem 1rem;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: background 0.14s;
      margin-left: auto;
    }
    .topbar-btn:hover {
      filter: brightness(1.07);
    }
    .container {
      max-width: 430px;
      margin: 2.2rem auto 0 auto;
      background: var(--box);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.2rem 0.7rem 1.2rem 0.7rem;
      font-size: 13px;
    }
    h1 {
      margin: 0 0 0.8rem 0;
      font-weight: 700;
      color: var(--primary);
      font-size: 1.15rem;
      letter-spacing:0.01em;
      text-align:center;
    }
    .button, button, input[type="submit"] {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 0.48rem 1rem;
      font-size: 0.98rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: background 0.15s;
      margin-top: 0.42rem;
      width: 100%;
      box-sizing: border-box;
    }
    .button.secondary {
      background: var(--accent);
      color: #fff;
    }
    .button:disabled, button:disabled {
      opacity: 0.65;
      cursor: not-allowed;
    }
    .button:hover:not(:disabled), button:hover:not(:disabled) {
      filter: brightness(1.07);
    }
    input, select {
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.48rem 1rem;
      font-size: 0.96rem;
      margin-top: 0.28rem;
      width: 100%;
      box-sizing: border-box;
      background: #f1f3f7;
      color: var(--text);
      outline: none;
      transition: border-color 0.13s;
    }
    input:focus, select:focus {
      border-color: var(--primary);
    }
    .section {
      margin-bottom: 1.2rem;
    }
    .wallet-card {
      background: linear-gradient(120deg, var(--primary) 65%, var(--accent));
      color: #fff;
      border-radius: var(--radius);
      padding: 0.8rem 0.7rem;
      margin-bottom: 1.2rem;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      font-size: 12px;
    }
    .wallet-address {
      font-size: 0.92rem;
      letter-spacing: 1px;
      word-break: break-all;
      opacity: 0.97;
    }
    .wallet-balance {
      font-size: 0.97rem;
      font-weight: bold;
      margin-top: 0.32rem;
      color: #fff;
      word-break: break-all;
    }
    .swap-box {
      background: #f9fafb;
      border-radius: 12px;
      padding: 1rem 0.6rem;
      box-shadow: 0 2px 12px rgba(130,87,230,0.07);
      margin-bottom: 1.1rem;
      font-size: 13px;
    }
    .swap-row {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.8rem;
    }
    .swap-row:last-child {
      margin-bottom: 0;
    }
    .swap-label {
      flex: 0 0 67px;
      font-weight: 500;
      color: var(--gray);
      font-size: 0.97rem;
    }
    .swap-input {
      flex: 1;
    }
    .swap-select {
      flex: 0 0 93px;
      font-size: 0.95rem;
    }
    .slippage-row {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.8rem;
      font-size:12px;
    }
    .slippage-label {
      flex: 0 0 67px;
      font-weight: 500;
      color: var(--gray);
      font-size: 0.91rem;
    }
    .slippage-input {
      width: 50px;
      text-align: right;
      font-size: 0.92rem;
      border-radius: 6px;
    }
    #errorMsg, .error-msg {
      color: var(--error);
      background: #ffe0e6;
      border-radius: 5px;
      padding: 6px 8px;
      font-size: 0.97rem;
      margin-bottom: 0.8rem;
      display: none;
    }
    #successMsg, .success-msg {
      color: var(--success);
      background: #e5fff7;
      border-radius: 5px;
      padding: 6px 8px;
      font-size: 0.97rem;
      margin-bottom: 0.8rem;
      display: none;
    }
    @media (max-width: 600px) {
      .container {
        padding: 0.6rem 0.1rem;
        max-width: 98vw;
      }
      .wallet-card, .swap-box {
        padding: 0.75rem 0.2rem;
      }
      .swap-select {
        flex: 0 0 78px;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.4.0/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <div class="topbar">
    <span class="topbar-title">FIXORIUM</span>
    <button id="connectWalletBtn" class="button topbar-btn">Connect Wallet</button>
  </div>
  <div class="container">
    <h1>DEX Token Swap</h1>
    <div id="walletCard" class="wallet-card" style="display:none;">
      <span id="walletTypeLabel"></span>
      <div class="wallet-address" id="walletAddress"></div>
      <div class="wallet-balance" id="walletBalance"></div>
      <button id="disconnectWalletBtn" class="button secondary" style="margin-top:1rem;">Logout</button>
    </div>
    <div id="errorMsg" class="error-msg"></div>
    <div id="successMsg" class="success-msg"></div>
    <div id="swapSection" class="section">
      <div class="swap-box">
        <div class="swap-row">
          <span class="swap-label">From</span>
          <input id="swapFromAmount" class="swap-input" type="number" min="0" step="any" placeholder="Amount" />
          <select id="swapFromToken" class="swap-select"></select>
        </div>
        <div class="swap-row">
          <span class="swap-label">To</span>
          <input id="swapToAmount" class="swap-input" type="number" min="0" step="any" placeholder="Amount" readonly />
          <select id="swapToToken" class="swap-select"></select>
        </div>
        <div class="slippage-row">
          <span class="slippage-label">Slippage</span>
          <input id="slippageInput" class="slippage-input" type="number" min="0.1" max="20" step="0.1" value="1" />%
        </div>
        <div id="feeInfo" style="margin-top:0.8rem; color:#6c757d; font-size:0.97rem;">
          DEX Fee: <b>0.03%</b> will be included in each swap.
        </div>
        <div id="feeAddr" style="margin-top:0.25rem;color:#6c757d;font-size:0.97rem;">
          Fee Address: <b>4w3kGzZ2ki2r6CwM5ZjiF9zv3B5r1xCw7f7dF9vF6x4x</b>
        </div>
        <button id="swapBtn" class="button" style="margin-top:1.5rem;">Swap</button>
      </div>
    </div>
  </div>
  <div id="walletModal" class="wallet-modal">
    <div class="wallet-modal-content">
      <div style="font-size:1.05rem; font-weight:600; margin-bottom:1.3rem;">Connect Wallet</div>
      <button id="phantomConnect" class="button" style="margin-bottom:0.7rem;">Phantom (Solana)</button>
      <button id="metamaskConnect" class="button secondary">MetaMask (Ethereum)</button>
      <button id="closeWalletModal" class="button" style="margin-top:1.1rem; background:#eee; color:#333;">Cancel</button>
    </div>
  </div>
  <script type="module">
    // --- TOKEN DATA ---
    const SOLANA_MEME_TOKENS = [
      { symbol: "SOL", name: "Solana", mint: "So11111111111111111111111111111111111111112", decimals: 9 },
      { symbol: "WIF", name: "dogwifhat", mint: "2oRZj1K8q6g7QpmS5jQSRtD1h41Tfq5gQJbA3g6vJwVn", decimals: 8 },
      { symbol: "BONK", name: "Bonk", mint: "DezX1xQ6ZhhXPb9D5e8C2J9pYc3i8c1a6h8VfmYbZ3Qh", decimals: 5 },
      { symbol: "MEW", name: "cat in a dogs world", mint: "6cA7QVY6L9Dn7dEyEfrXzQK6pQ6TjA2R8fLJwNr1cCzN", decimals: 6 },
      { symbol: "SAMO", name: "Samoyedcoin", mint: "7xKX2W5ZfVbknk8V2yZ6pR6A2K1v8R4F7k4G7U7vS8g", decimals: 9 },
      { symbol: "POPCAT", name: "Popcat", mint: "8XQ8h4pT3X8A8sQp8t8o9R2w8S1H3rT9Z1kJ8h2B6R9r", decimals: 6 },
      { symbol: "MYRO", name: "Myro", mint: "MYrVt4B8W5vX3gX8K9y2pJ3pB8d7G6zQ6q4r9v2xM2w", decimals: 6 },
      { symbol: "FIXER", name: "Fixercoin", mint: "4w3kGzZ2ki2r6CwM5ZjiF9zv3B5r1xCw7f7dF9vF6x4x", decimals: 6 }
    ];
    const JUPITER_API = "https://quote-api.jup.ag/v6";
    let walletType = null, solanaWallet = null, ethProvider = null, publicKey = null, ethAddress = null;
    let connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
    // --- UI Elements ---
    const connectWalletBtn = document.getElementById('connectWalletBtn');
    const walletModal = document.getElementById('walletModal');
    const phantomConnect = document.getElementById('phantomConnect');
    const metamaskConnect = document.getElementById('metamaskConnect');
    const closeWalletModal = document.getElementById('closeWalletModal');
    const walletCard = document.getElementById('walletCard');
    const walletTypeLabel = document.getElementById('walletTypeLabel');
    const walletAddress = document.getElementById('walletAddress');
    const walletBalance = document.getElementById('walletBalance');
    const disconnectWalletBtn = document.getElementById('disconnectWalletBtn');
    const swapSection = document.getElementById('swapSection');
    const swapFromAmount = document.getElementById('swapFromAmount');
    const swapToAmount = document.getElementById('swapToAmount');
    const swapFromToken = document.getElementById('swapFromToken');
    const swapToToken = document.getElementById('swapToToken');
    const swapBtn = document.getElementById('swapBtn');
    const slippageInput = document.getElementById('slippageInput');
    const errorMsg = document.getElementById('errorMsg');
    const successMsg = document.getElementById('successMsg');
    // --- MODAL LOGIC ---
    connectWalletBtn.onclick = () => walletModal.classList.add('open');
    closeWalletModal.onclick = () => walletModal.classList.remove('open');
    walletModal.addEventListener('mousedown', e => {
      if (!e.target.closest('.wallet-modal-content')) walletModal.classList.remove('open');
    });
    window.addEventListener('keydown', e => {
      if (e.key === "Escape") walletModal.classList.remove('open');
    });
    // --- PHANTOM ---
    phantomConnect.onclick = async () => {
      walletModal.classList.remove('open');
      const solana = window.solana;
      if (!solana || !solana.isPhantom) {
        showError("Phantom Wallet extension not found! Install Phantom extension.");
        return;
      }
      try {
        const resp = await solana.connect();
        walletType = "phantom";
        solanaWallet = solana;
        publicKey = resp.publicKey;
        ethProvider = null;
        ethAddress = null;
        await updateWalletUI();
        await updateSwapEstimate();
      } catch (e) {
        showError("Wallet connection error: " + (e.message || e));
      }
    };
    // --- METAMASK ---
    metamaskConnect.onclick = async () => {
      walletModal.classList.remove('open');
      if (!window.ethereum || !window.ethereum.isMetaMask) {
        showError("MetaMask extension not found! Install MetaMask extension.");
        return;
      }
      try {
        ethProvider = new ethers.providers.Web3Provider(window.ethereum, "any");
        await ethProvider.send("eth_requestAccounts", []);
        const signer = ethProvider.getSigner();
        ethAddress = await signer.getAddress();
        walletType = "metamask";
        solanaWallet = null;
        publicKey = null;
        await updateWalletUI();
        showSuccess("MetaMask connected! (Only Solana swaps supported in this DApp)");
      } catch (e) {
        showError("MetaMask connection error: " + (e.message || e));
      }
    };
    disconnectWalletBtn.onclick = () => {
      if (walletType === "phantom" && window.solana && window.solana.isPhantom && window.solana.disconnect) {
        window.solana.disconnect();
      }
      walletType = null;
      solanaWallet = null;
      ethProvider = null;
      publicKey = null;
      ethAddress = null;
      updateWalletUI();
      clearSwapInputs();
    };
    // --- UI LOGIC ---
    function showError(msg) {
      errorMsg.textContent = msg;
      errorMsg.style.display = 'block';
      setTimeout(() => errorMsg.style.display = 'none', 8000);
    }
    function showSuccess(msg) {
      successMsg.textContent = msg;
      successMsg.style.display = 'block';
      setTimeout(() => successMsg.style.display = 'none', 6000);
    }
    function hideMsgs() {
      errorMsg.style.display = 'none';
      successMsg.style.display = 'none';
    }
    function populateTokenSelect(select, tokens) {
      select.innerHTML = '';
      tokens.forEach((token, idx) => {
        const opt = document.createElement('option');
        opt.value = idx;
        opt.textContent = token.symbol;
        select.appendChild(opt);
      });
    }
    async function updateWalletUI() {
      try {
        if (walletType === 'phantom' && publicKey) {
          walletCard.style.display = '';
          walletTypeLabel.textContent = 'Connected (Phantom):';
          walletAddress.textContent = publicKey.toBase58();
          let balances = [];
          const solBal = await connection.getBalance(publicKey);
          balances.push((solBal / 1e9).toFixed(4) + " SOL");
          const tokenAccounts = await connection.getParsedTokenAccountsByOwner(
            publicKey,
            { programId: solanaWeb3.TokenInstructions.TOKEN_PROGRAM_ID }
          );
          for (const token of SOLANA_MEME_TOKENS) {
            if (token.symbol === "SOL") continue;
            const found = tokenAccounts.value.find(
              acc => acc.account.data.parsed.info.mint === token.mint
            );
            if (found) {
              const uiAmount = found.account.data.parsed.info.tokenAmount.uiAmount;
              balances.push(`${uiAmount} ${token.symbol}`);
            }
          }
          walletBalance.textContent = balances.join(" / ");
          disconnectWalletBtn.style.display = '';
        } else if (walletType === 'metamask' && ethAddress) {
          walletCard.style.display = '';
          walletTypeLabel.textContent = 'Connected (MetaMask):';
          walletAddress.textContent = ethAddress;
          walletBalance.textContent = '';
          disconnectWalletBtn.style.display = '';
        } else {
          walletCard.style.display = 'none';
          disconnectWalletBtn.style.display = 'none';
        }
      } catch (e) {
        showError("Failed to load wallet balances: " + (e.message || e));
      }
    }
    function clearSwapInputs() {
      swapFromAmount.value = '';
      swapToAmount.value = '';
    }
    // --- INIT TOKEN SELECTS ---
    populateTokenSelect(swapFromToken, SOLANA_MEME_TOKENS);
    populateTokenSelect(swapToToken, SOLANA_MEME_TOKENS);
    swapFromToken.value = 0;
    swapToToken.value = 1;
    swapFromToken.onchange = () => {
      if (swapFromToken.value === swapToToken.value) {
        swapToToken.value = (parseInt(swapFromToken.value) + 1) % SOLANA_MEME_TOKENS.length;
      }
      updateSwapEstimate();
    };
    swapToToken.onchange = () => {
      if (swapToToken.value === swapFromToken.value) {
        swapFromToken.value = (parseInt(swapToToken.value) + 1) % SOLANA_MEME_TOKENS.length;
      }
      updateSwapEstimate();
    };
    swapFromAmount.oninput = updateSwapEstimate;
    slippageInput.oninput = updateSwapEstimate;
    // --- SWAP ESTIMATE ---
    async function updateSwapEstimate() {
      hideMsgs();
      swapToAmount.value = '';
      const fromIdx = parseInt(swapFromToken.value);
      const toIdx = parseInt(swapToToken.value);
      if (isNaN(fromIdx) || isNaN(toIdx)) return;
      const fromToken = SOLANA_MEME_TOKENS[fromIdx];
      const toToken = SOLANA_MEME_TOKENS[toIdx];
      const amount = parseFloat(swapFromAmount.value);
      if (!fromToken || !toToken || !amount || amount <= 0) return;
      try {
        const quoteUrl = `${JUPITER_API}/quote?inputMint=${fromToken.mint}&outputMint=${toToken.mint}&amount=${(amount * Math.pow(10, fromToken.decimals)).toFixed(0)}&slippageBps=${parseFloat(slippageInput.value) * 100}`;
        const res = await fetch(quoteUrl);
        const data = await res.json();
        if (data && data.outAmount) {
          swapToAmount.value = (parseFloat(data.outAmount) / Math.pow(10, toToken.decimals)).toFixed(6);
        } else {
          swapToAmount.value = '';
        }
      } catch (e) {
        swapToAmount.value = '';
        showError("Swap estimation error. Try again.");
      }
    }
    // --- SWAP LOGIC ---
    swapBtn.onclick = async () => {
      hideMsgs();
      // Prevent swap if not connected to Phantom
      if (walletType !== "phantom" || !publicKey) {
        showError("Please connect your Phantom wallet to perform a swap.");
        return;
      }
      const fromIdx = parseInt(swapFromToken.value);
      const toIdx = parseInt(swapToToken.value);
      const fromToken = SOLANA_MEME_TOKENS[fromIdx];
      const toToken = SOLANA_MEME_TOKENS[toIdx];
      const amount = parseFloat(swapFromAmount.value);
      if (!fromToken || !toToken || !amount || amount <= 0) {
        showError("Enter valid amount and tokens.");
        return;
      }
      if (fromToken.mint === toToken.mint) {
        showError("Cannot swap the same token.");
        return;
      }
      swapBtn.disabled = true;
      swapBtn.textContent = "Swapping...";
      try {
        // Fetch Jupiter swap transactions
        const quoteUrl = `${JUPITER_API}/quote?inputMint=${fromToken.mint}&outputMint=${toToken.mint}&amount=${(amount * Math.pow(10, fromToken.decimals)).toFixed(0)}&slippageBps=${parseFloat(slippageInput.value) * 100}`;
        const quoteRes = await fetch(quoteUrl);
        const quoteData = await quoteRes.json();
        if (!quoteData.routePlan || !quoteData.outAmount) {
          throw new Error("No swap route found.");
        }
        // Build swap transaction
        const swapTxRes = await fetch(`${JUPITER_API}/swap`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            route: quoteData,
            userPublicKey: publicKey.toBase58(),
            wrapUnwrapSOL: true,
            dynamicComputeUnitLimit: true
          })
        });
        const swapTxData = await swapTxRes.json();
        if (!swapTxData.swapTransaction) throw new Error("Swap transaction build failed.");
        // Sign and send
        const swapTx = solanaWeb3.Transaction.from(Buffer.from(swapTxData.swapTransaction, "base64"));
        swapTx.feePayer = publicKey;
        swapTx.recentBlockhash = (await connection.getRecentBlockhash()).blockhash;
        const signedTx = await solanaWallet.signTransaction(swapTx);
        const txid = await connection.sendRawTransaction(signedTx.serialize());
        await connection.confirmTransaction(txid, "finalized");
        showSuccess("Swap complete! Tx: " + txid.slice(0, 8) + "...");
        await updateWalletUI();
        clearSwapInputs();
      } catch (e) {
        showError("Swap failed: " + (e.message || e));
      } finally {
        swapBtn.disabled = false;
        swapBtn.textContent = "Swap";
      }
    };
    // --- INIT LOAD ---
    window.addEventListener("DOMContentLoaded", async () => {
      updateWalletUI();
      updateSwapEstimate();
    });
  </script>
</body>
</html>

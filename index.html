 <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>FIXORIUM Swap System</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Import React, ReactDOM and required Solana wallet libraries via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@solana/web3.js@1.92.1/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-base@0.21.0/lib/index.umd.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-react@0.21.0/lib/index.umd.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-react-ui@0.21.0/lib/index.umd.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-wallets@0.21.0/lib/index.umd.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #181A20;
      min-height: 100vh;
      padding-bottom: 64px;
      color: white;
    }

    .fixorium-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 24px;
      background: #23272F;
      flex-wrap: wrap;
      gap: 12px;
    }

    .fixorium-logo {
      height: 36px;
      width: 36px;
      margin-right: 10px;
    }

    .fixorium-title {
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      white-space: nowrap;
    }

    .wallet-section {
      background: #31363F;
      border-radius: 6px;
      padding: 5px 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      min-width: 225px;
      font-size: 14px;
    }

    button.wallet-button {
      cursor: pointer;
      background: #29D6B6;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-weight: bold;
      color: #23272F;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }

    button.wallet-button:hover {
      background-color: #22bca7;
    }

    .swap-card {
      background: #23272F;
      margin: 32px auto;
      border-radius: 16px;
      box-shadow: 0 8px 24px #0003;
      padding: 32px 24px;
      width: 100%;
      max-width: 450px;
      box-sizing: border-box;
    }

    .swap-label {
      color: #fff;
      font-weight: bold;
      margin-top: 10px;
      display: block;
      font-size: 14px;
    }

    .swap-input,
    select {
      width: 100%;
      padding: 6px 10px;
      border-radius: 4px;
      border: none;
      background: #31363F;
      color: #fff;
      margin: 6px 0 14px;
      font-size: 14px;
      box-sizing: border-box;
    }

    .swap-btn {
      background: #29D6B6;
      color: #23272F;
      font-weight: bold;
      padding: 10px 0;
      width: 100%;
      border: none;
      border-radius: 6px;
      margin-top: 10px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }

    .swap-btn:disabled {
      opacity: .5;
      cursor: not-allowed;
    }

    .balances-list {
      color: #fff;
      margin-top: 20px;
      font-size: 14px;
      line-height: 1.5;
      min-height: 50px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .signal-bot {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #23272F;
      padding: 16px 0;
      display: flex;
      justify-content: center;
      border-top: 1px solid #23272F;
      z-index: 1000;
      gap: 24px;
      user-select: none;
      flex-wrap: wrap;
      font-size: 18px;
      color: #fff;
    }

    .signal {
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .signal-buy {
      color: #29D6B6;
      font-weight: 700;
      animation: blinkBuy 1s linear infinite;
    }

    .signal-sell {
      color: #F73E3E;
      font-weight: 700;
      animation: blinkSell 1s linear infinite;
    }

    .signal-small {
      font-size: 10px;
      opacity: 0.6;
      user-select: none;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    @keyframes blinkBuy {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.3;
      }

      100% {
        opacity: 1;
      }
    }

    @keyframes blinkSell {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.3;
      }

      100% {
        opacity: 1;
      }
    }

    a.swap-link {
      color: #29d6b6;
      text-decoration: underline;
      word-break: break-word;
      font-size: 13px;
    }

    @media (max-width: 480px) {
      .swap-card {
        width: 90%;
        padding: 24px 16px;
      }

      .wallet-section {
        justify-content: center;
        min-width: auto;
      }

      .signal-bot {
        font-size: 14px;
        gap: 12px;
        padding: 12px 4px;
      }

      .signal {
        font-size: 14px;
        gap: 4px;
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/javascript">
    const {
      React,
      ReactDOM
    } = window;
    const {
      useState,
      useEffect,
      useMemo,
      useCallback,
      Fragment
    } = React;

    const {
      PublicKey,
      Transaction,
      Connection
    } = solanaWeb3;

    const {
      PhantomWalletAdapter
    } = window.WalletAdapterWallets;
    const {
      WalletProvider,
      useWallet,
      useConnection
    } = window.WalletAdapterReact;
    const {
      WalletModalProvider,
      WalletMultiButton
    } = window.WalletAdapterReactUi;

    // Constants
    const SOLANA_RPC = "https://api.mainnet-beta.solana.com";

    const MEME_TOKEN_MINTS = [
      "So11111111111111111111111111111111111111112",
      "DezXAZ8z7PnrnRJjz3wXBoRhwTLdMPkqhuBczetogeoK",
      "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
      "EKpQGSJtjMFqKZ9KQanSqYXRcF8fBtUk6goG7zcX3New",
    ];

    const MEME_TOKEN_NAMES = {
      So11111111111111111111111111111111111111112: "SOL",
      DezXAZ8z7PnrnRJjz3wXBoRhwTLdMPkqhuBczetogeoK: "BONK",
      EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v: "USDC",
      EKpQGSJtjMFqKZ9KQanSqYXRcF8fBtUk6goG7zcX3New: "WIF"
    };

    const SIGNAL_BOT_SMALL_TOKENS = ["BTC", "SOL", "FIXERCOIN"];

    function shortenAddress(addr) {
      return addr.slice(0, 4) + "..." + addr.slice(-4);
    }

    async function retry(fn, times = 3, delay = 300) {
      let err;
      for (let i = 0; i < times; i++) {
        try {
          return await fn();
        } catch (e) {
          err = e;
          await new Promise(resolve => setTimeout(resolve, delay));
        }
      }
      throw err;
    }

    const SignalBot = () => {
      const [signals, setSignals] = useState([]);

      function randomSignal() {
        return Math.random() > 0.5 ? "BUY" : "SELL";
      }

      useEffect(() => {
        function updateSignals() {
          setSignals(SIGNAL_BOT_SMALL_TOKENS.map(tok => ({
            token: tok,
            signal: randomSignal()
          })));
        }
        updateSignals();
        const interval = setInterval(updateSignals, 2000);
        return () => clearInterval(interval);
      }, []);

      return React.createElement("div", {
        className: "signal-bot",
        "aria-label": "Market signals",
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          width: "100%",
          background: "#23272F",
          padding: 16,
          display: "flex",
          justifyContent: "center",
          borderTop: "1px solid #23272F",
          gap: 24,
          userSelect: "none",
          flexWrap: "wrap",
          fontSize: 18,
          color: "white",
          zIndex: 1000
        }
      }, signals.map(({ token, signal }) =>
        React.createElement("div", {
          key: token,
          className: "signal signal-small",
          "aria-live": "polite",
          style: {
            fontSize: 10,
            opacity: 0.6,
            fontWeight: 600,
            letterSpacing: "0.05em",
            display: "flex",
            alignItems: "center",
            gap: 8,
            whiteSpace: "nowrap"
          }
        }, React.createElement("span", {
          "aria-label": "Token"
        }, token), React.createElement("span", {
          className: `signal-${signal.toLowerCase()}`,
          "aria-label": `${signal} signal`,
          style: {
            fontWeight: "700",
            animation: "blink 1s linear infinite",
            color: signal === "BUY" ? "#29D6B6" : "#F73E3E"
          }
        }, signal))
      ));
    };

    function App() {
      const wallets = useMemo(() => [new PhantomWalletAdapter()], []);
      return React.createElement(WalletProvider, { wallets: wallets, autoConnect: true },
        React.createElement(WalletModalProvider, null,
          React.createElement(SwapApp)
        )
      );
    }

    function SwapApp() {
      const { connection } = useConnection();
      const { publicKey, connected, sendTransaction, disconnect } = useWallet();

      const [balances, setBalances] = useState({});
      const [fromToken, setFromToken] = useState(MEME_TOKEN_MINTS[0]);
      const [toToken, setToToken] = useState(MEME_TOKEN_MINTS[1]);
      const [amount, setAmount] = useState("");
      const [swapRatio, setSwapRatio] = useState("");
      const [swapStatus, setSwapStatus] = useState("");
      const [loading, setLoading] = useState(false);

      const fetchBalances = useCallback(async () => {
        if (!connected || !publicKey) return;
        try {
          const ownerPubkey = publicKey;
          let solBalance = await retry(() => connection.getBalance(ownerPubkey));
          const newBalances = {
            SOL: solBalance / 1e9,
          };
          for (const mintAddress of MEME_TOKEN_MINTS) {
            if (mintAddress === "So11111111111111111111111111111111111111112") continue;
            const mintPubKey = new PublicKey(mintAddress);
            const tokenAccounts = await retry(() =>
              connection.getParsedTokenAccountsByOwner(ownerPubkey, { mint: mintPubKey })
            );
            let totalBal = 0;
            if (tokenAccounts.value.length > 0) {
              totalBal = tokenAccounts.value.reduce((acc, item) => {
                const uiAmount = item.account.data.parsed.info.tokenAmount.uiAmount || 0;
                return acc + uiAmount;
              }, 0);
            }
            newBalances[MEME_TOKEN_NAMES[mintAddress] || mintAddress.slice(0, 6)] = totalBal;
          }
          setBalances(newBalances);
        } catch (e) {
          console.warn("Failed to fetch balances:", e);
        }
      }, [connection, connected, publicKey]);

      useEffect(() => {
        if (connected) fetchBalances();
      }, [connected, fetchBalances]);

      useEffect(() => {
        async function updateRatio() {
          setSwapRatio("");
          if (!amount || amount <= 0) return;
          if (fromToken === toToken) {
            setSwapRatio("From and To tokens cannot be the same.");
            return;
          }
          try {
            const amountInBase = Math.floor(parseFloat(amount) * 1e9);
            const res = await fetch(
              `https://quote-api.jup.ag/v6/quote?inputMint=${fromToken}&outputMint=${toToken}&amount=${amountInBase}&slippageBps=50`
            );
            const data = await res.json();
            if (!data.routes || data.routes.length === 0) {
              setSwapRatio("No swap route found.");
              return;
            }
            const outAmountUi = data.routes[0].outAmountUI;
            const rate = outAmountUi / parseFloat(amount);
            setSwapRatio(`Estimated rate: 1 ${MEME_TOKEN_NAMES[fromToken] || fromToken} ≈ ${rate.toFixed(6)} ${MEME_TOKEN_NAMES[toToken] || toToken}`);
          } catch {
            setSwapRatio("Failed to fetch swap rate.");
          }
        }
        updateRatio();
      }, [amount, fromToken, toToken]);

      const handleSwap = async () => {
        if (!connected || !publicKey) {
          alert("Please connect your Phantom wallet.");
          return;
        }
        if (!amount || amount <= 0) {
          alert("Enter a valid swap amount.");
          return;
        }
        if (fromToken === toToken) {
          alert("Swap tokens must be different.");
          return;
        }
        setSwapStatus("Fetching best route...");
        setLoading(true);
        try {
          const amountInBase = Math.floor(parseFloat(amount) * 1e9);
          const quoteRes = await fetch(
            `https://quote-api.jup.ag/v6/quote?inputMint=${fromToken}&outputMint=${toToken}&amount=${amountInBase}&slippageBps=50`
          );
          const quote = await quoteRes.json();
          if (!quote.routes || quote.routes.length === 0) {
            setSwapStatus("No swap route found.");
            setLoading(false);
            return;
          }
          const bestRoute = quote.routes[0];
          setSwapStatus("Building swap transaction...");

          const swapRes = await fetch("https://quote-api.jup.ag/v6/swap", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              route: bestRoute,
              userPublicKey: publicKey.toBase58(),
              wrapAndUnwrapSol: true,
            }),
          });

          const swapTx = await swapRes.json();

          if (!swapTx.swapTransaction) {
            setSwapStatus("Failed to build swap transaction.");
            setLoading(false);
            return;
          }
          setSwapStatus("Signing and sending transaction...");
          const txBuffer = Uint8Array.from(atob(swapTx.swapTransaction), c => c.charCodeAt(0));
          const transaction = Transaction.from(txBuffer);

          const signature = await sendTransaction(transaction, connection);

          setSwapStatus(
            React.createElement(Fragment, null,
              "Swap transaction sent! ",
              React.createElement("a", {
                href: `https://solscan.io/tx/${signature}`,
                target: "_blank",
                rel: "noopener noreferrer",
                className: "swap-link",
                style: { color: "#29d6b6", textDecoration: "underline" }
              }, "View on Solscan"))
          );
          await fetchBalances();
        } catch (err) {
          setSwapStatus("Error during swap: " + (err.message || err));
        } finally {
          setLoading(false);
        }
      };

      return React.createElement(Fragment, null,
        React.createElement("div", {
          className: "fixorium-header",
          style: {
            display: "flex",
            alignItems: "center",
            justifyContent: "space-between",
            padding: 12,
            background: "#23272F",
            flexWrap: "wrap",
            gap: 12
          }
        },
          React.createElement("div", { style: { display: "flex", alignItems: "center" } },
            React.createElement("svg", {
              className: "fixorium-logo",
              viewBox: "0 0 64 64",
              "aria-hidden": true,
              focusable: false,
              width: 36,
              height: 36,
              style: { marginRight: 10 }
            },
              React.createElement("circle", { cx: 32, cy: 32, r: 32, fill: "#29D6B6" }),
              React.createElement("text", {
                x: 32,
                y: 42,
                textAnchor: "middle",
                fontSize: 28,
                fill: "#23272F",
                fontFamily: "Arial",
                fontWeight: "bold"
              }, "F")
            ),
            React.createElement("span", {
              style: { color: "white", fontSize: 24, fontWeight: "bold", whiteSpace: "nowrap" }
            }, "FIXORIUM")
          ),
          React.createElement("div", {
            className: "wallet-section",
            "aria-live": "polite",
            "aria-label": "Wallet connection status",
            style: {
              background: "#31363F",
              borderRadius: 6,
              padding: "5px 15px",
              display: "flex",
              alignItems: "center",
              gap: 10,
              flexWrap: "wrap",
              justifyContent: "flex-end",
              minWidth: 225,
              fontSize: 14
            }
          },
            React.createElement(WalletMultiButton, { className: "wallet-button" }),
            connected && React.createElement("button", {
              className: "wallet-button",
              onClick: disconnect,
              style: { marginLeft: 8 }
            }, "Disconnect")
          )
        ),
        React.createElement("main", null,
          React.createElement("section", {
            className: "swap-card",
            role: "main",
            "aria-label": "Token swap interface",
            style: {
              background: "#23272F",
              margin: "32px auto",
              borderRadius: 16,
              boxShadow: "0 8px 24px #0003",
              padding: "32px 24px",
              maxWidth: 450,
              width: "100%",
              boxSizing: "border-box"
            }
          },
            React.createElement("form", {
              onSubmit: e => {
                e.preventDefault();
                if (!loading) handleSwap();
              },
              "aria-describedby": "swapStatus"
            },
              React.createElement("label", { htmlFor: "fromToken", className: "swap-label" }, "From Token"),
              React.createElement("select", {
                id: "fromToken",
                name: "fromToken",
                "aria-required": true,
                value: fromToken,
                onChange: e => setFromToken(e.target.value),
                disabled: !connected || loading,
                className: "swap-input",
              }, MEME_TOKEN_MINTS.map(mint =>
                React.createElement("option", { key: mint, value: mint },
                  MEME_TOKEN_NAMES[mint] || mint.slice(0, 6)
                )
              )),
              React.createElement("label", { htmlFor: "toToken", className: "swap-label" }, "To Token"),
              React.createElement("select", {
                id: "toToken",
                name: "toToken",
                "aria-required": true,
                value: toToken,
                onChange: e => setToToken(e.target.value),
                disabled: !connected || loading,
                className: "swap-input",
              }, MEME_TOKEN_MINTS.map(mint =>
                React.createElement("option", { key: mint, value: mint },
                  MEME_TOKEN_NAMES[mint] || mint.slice(0, 6)
                )
              )),
              React.createElement("label", { htmlFor: "swapAmount", className: "swap-label" }, "Amount"),
              React.createElement("input", {
                id: "swapAmount",
                name: "swapAmount",
                className: "swap-input",
                type: "number",
                min: "0",
                step: "any",
                placeholder: "Enter amount",
                "aria-required": true,
                disabled: !connected || loading,
                value: amount,
                onChange: e => setAmount(e.target.value)
              }),
              React.createElement("div", {
                id: "swapRatio",
                style: { color: "#ccc", fontSize: 14, minHeight: 18, marginBottom: 8 }
              }, swapRatio),
              React.createElement("button", {
                id: "swapBtn",
                className: "swap-btn",
                type: "submit",
                disabled: (!connected || loading || !amount || amount <= 0 || fromToken === toToken),
                "aria-live": "polite",
                "aria-busy": loading,
                style: { cursor: loading ? "not-allowed" : "pointer" }
              }, loading ? "Swapping..." : "Swap"),
              React.createElement("div", {
                id: "swapStatus",
                role: "status",
                "aria-live": "polite",
                style: { color: "#29D6B6", marginTop: 12, minHeight: 32 }
              }, swapStatus)
            ),
            React.createElement("div", {
              className: "balances-list",
              "aria-label": "Wallet balances",
              style: { marginTop: 20, fontSize: 14, whiteSpace: "pre-wrap" }
            },
              React.createElement("ul", { style: { paddingLeft: 20, margin: 0 } },
                Object.entries(balances).map(([token, bal]) =>
                  React.createElement("li", { key: token },
                    React.createElement("b", null, token),
                    ": ",
                    bal.toLocaleString(undefined, { minimumFractionDigits: 4, maximumFractionDigits: 9 })
                  )
                )
              )
            )
          )
        ),
        React.createElement(SignalBot)
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>
</body>

</html>

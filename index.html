 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fixorium Swap</title>
  <style>
    body {
      margin: 0;
      background-color: #0e0e0e;
      color: #f0f0f0;
      font-family: 'Segoe UI', sans-serif;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background-color: #1a1a1a;
      border-bottom: 1px solid #333;
    }
    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      color: #00ffcc;
    }
    .wallet-buttons {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    button {
      padding: 0.4rem 1rem;
      background-color: #222;
      color: white;
      border: 1px solid #444;
      border-radius: 0.4rem;
      cursor: pointer;
      font-size: 0.9rem;
    }
    button:hover {
      background-color: #333;
    }
    main {
      padding: 2rem;
      max-width: 500px;
      margin: 2rem auto;
      background-color: #1a1a1a;
      border-radius: 1rem;
      box-shadow: 0 0 10px #000;
    }
    h3 {
      margin-top: 0;
      color: #00ffcc;
    }
    .token-select, .amount-input, .slippage-input {
      margin-bottom: 1rem;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 0.6rem;
      border-radius: 0.3rem;
      border: 1px solid #333;
      background-color: #121212;
      color: white;
      font-size: 1rem;
    }
    .status {
      margin: 1rem 0;
      font-weight: bold;
    }
    .balance-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }
    .conversion {
      font-size: 0.85rem;
      color: #999;
      text-align: right;
    }
    .loading {
      font-size: 0.85rem;
      color: yellow;
    }
  </style>
  <script src="https://unpkg.com/@solana/web3.js@1.86.1/lib/index.iife.min.js"></script>
</head>
<body>
  <header>
    <div class="logo">Fixorium Swap</div>
    <div class="wallet-buttons">
      <span id="walletAddress">Not connected</span>
      <button id="connectWallet">Connect Wallet</button>
      <button id="disconnectWallet" style="display: none;">Disconnect</button>
    </div>
  </header>

  <main>
    <div class="balance-row">
      <div>Wallet Balance</div>
      <div><span id="walletBalance">0</span></div>
    </div>

    <h3>Swap</h3>
    <div class="token-select">
      <label for="fromToken">From:</label>
      <select id="fromToken"></select>
    </div>
    <div class="token-select">
      <label for="toToken">To:</label>
      <select id="toToken"></select>
    </div>
    <div class="amount-input">
      <input type="number" id="amount" placeholder="Enter amount" />
    </div>
    <div class="slippage-input">
      <label for="slippage">Slippage (%):</label>
      <input type="number" id="slippage" value="0.5" min="0.1" step="0.1" />
    </div>
    <div class="conversion">
      Total Value (in USDT): <span id="conversionValue">-</span>
    </div>
    <div id="loadingIndicator" class="loading" style="display: none;">Loading...</div>
    <button id="getQuote">Preview Quote</button>
    <button id="executeSwap" style="display: none;">Confirm Transaction</button>
    <div id="quoteResult" class="status"></div>
  </main>

  <script>
    const TOKEN_LIST = [
      { symbol: "SOL", mint: "So11111111111111111111111111111111111111112" },
      { symbol: "USDC", mint: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v" },
      { symbol: "USDT", mint: "Es9vMFrzaCERh76a8mZ6nUp7GNaEKz7iC7yxuhF4VjeT" },
      { symbol: "RAY", mint: "4k3Dyjzvzp8eM4b6SYYC7CvNnFD1iPogWzJpr6bL5Pcg" },
      { symbol: "BONK", mint: "DezXqL4FUxC3xNSFwy9RfUZxkHzQhEe3yFK28Ew4kZNe" }
    ];

    let connection;
    let walletPublicKey = null;
    let lastQuote = null;

    function initializeConnection() {
      connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
    }

    function shortenAddress(address) {
      return address.slice(0, 4) + "..." + address.slice(-4);
    }

    async function connectWallet() {
      try {
        const provider = window.solana;
        if (!provider?.isPhantom) return alert("Phantom Wallet not found");

        await provider.connect();
        walletPublicKey = provider.publicKey;

        document.getElementById("walletAddress").textContent = shortenAddress(walletPublicKey.toBase58());
        document.getElementById("connectWallet").style.display = "none";
        document.getElementById("disconnectWallet").style.display = "inline-block";

        const balance = await connection.getBalance(walletPublicKey);
        document.getElementById("walletBalance").textContent = `${(balance / 1e9).toFixed(4)} SOL`;
      } catch (err) {
        console.error("Wallet connection error:", err);
        alert("Could not connect wallet.");
      }
    }

    function disconnectWallet() {
      walletPublicKey = null;
      document.getElementById("walletAddress").textContent = "Not connected";
      document.getElementById("walletBalance").textContent = "0";
      document.getElementById("connectWallet").style.display = "inline-block";
      document.getElementById("disconnectWallet").style.display = "none";
    }

    async function fetchQuote() {
      const inputMint = document.getElementById("fromToken").value;
      const outputMint = document.getElementById("toToken").value;
      const amount = parseFloat(document.getElementById("amount").value);
      const slippage = parseFloat(document.getElementById("slippage").value);
      if (!inputMint || !outputMint || !amount || !slippage) return alert("Fill all fields");

      document.getElementById("loadingIndicator").style.display = "block";

      try {
        const res = await fetch(`https://quote-api.jup.ag/v6/quote?inputMint=${inputMint}&outputMint=${outputMint}&amount=${amount * 1e6}&slippageBps=${slippage * 100}`);
        const data = await res.json();

        if (!data?.outAmount) throw new Error("Invalid quote");

        document.getElementById("quoteResult").textContent = `Estimated: ${(data.outAmount / 1e6).toFixed(6)} Tokens`;
        document.getElementById("conversionValue").textContent = (data.outAmount / 1e6).toFixed(2) + ' USDT';
        document.getElementById("executeSwap").style.display = "inline-block";
        lastQuote = data;
      } catch (err) {
        console.error(err);
        alert("Quote fetch failed");
      } finally {
        document.getElementById("loadingIndicator").style.display = "none";
      }
    }

    async function executeSwap() {
      if (!walletPublicKey || !lastQuote) return alert("No quote or wallet connected");
      try {
        const swapRes = await fetch("https://quote-api.jup.ag/v6/swap", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userPublicKey: walletPublicKey.toBase58(),
            quoteResponse: lastQuote,
            wrapUnwrapSOL: true,
            computeUnitPriceMicroLamports: 5000
          })
        });

        const { swapTransaction } = await swapRes.json();
        const recoveredTx = solanaWeb3.Transaction.from(Buffer.from(swapTransaction, "base64"));

        const signed = await window.solana.signTransaction(recoveredTx);
        const txid = await connection.sendRawTransaction(signed.serialize());

        document.getElementById("quoteResult").textContent = `Transaction sent: ${txid}`;
      } catch (err) {
        console.error(err);
        alert("Swap failed");
      }
    }

    document.getElementById("connectWallet").addEventListener("click", connectWallet);
    document.getElementById("disconnectWallet").addEventListener("click", disconnectWallet);
    document.getElementById("getQuote").addEventListener("click", fetchQuote);
    document.getElementById("executeSwap").addEventListener("click", executeSwap);

    window.addEventListener("load", () => {
      const waitForSolana = setInterval(() => {
        if (window.solana && window.solana.isPhantom) {
          clearInterval(waitForSolana);
          initializeConnection();
        }
      }, 100);

      TOKEN_LIST.forEach(token => {
        const opt1 = document.createElement("option");
        opt1.value = token.mint;
        opt1.textContent = token.symbol;
        document.getElementById("fromToken").appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = token.mint;
        opt2.textContent = token.symbol;
        document.getElementById("toToken").appendChild(opt2);
      });
    });
  </script>
</body>
</html>

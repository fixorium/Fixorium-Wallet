 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FIXORIUM</title>

  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <!-- solana-web3.js -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.75.0/lib/index.iife.min.js"></script>
  <!-- solana-spl-token -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.3.5/lib/index.iife.min.js"></script>

  <style>
    body {
      font-family: "arial", arial, arial, arial, arial;
      max-width: 480px;
      margin: 30px auto 70px auto;
      font-size: 14px;
      background: #f9f9f9;
      color: #222;
      padding: 0 15px 0 15px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      position: relative;
      min-height: 100vh;
    }
    h1 {
      font-weight: 900;
      text-align: center;
      margin-bottom: 10px;
      font-size: 2rem;
      color: #007aff;
      user-select: text;
    }
    h2 {
      font-weight: 600;
      text-align: center;
      margin-bottom: 25px;
      font-size: 1.4rem;
    }
    button {
      cursor: pointer;
      background-color: #007aff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 0.9rem;
      padding: 8px 16px;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover:not([disabled]){
      background-color: #005ecb;
    }
    button[disabled] {
      background-color: #a0a0a0;
      cursor: not-allowed;
    }
    fieldset {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin-top: 12px;
      background: white;
    }
    legend {
      font-weight: 700;
      font-size: 1.1rem;
      padding: 0 8px;
    }
    label {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 4px;
      display: block;
    }
    select, input[type=number] {
      width: 100%;
      padding: 6px 8px;
      font-size: 0.9rem;
      border: 1px solid #bbb;
      border-radius: 5px;
      box-sizing: border-box;
      margin-top: 4px;
      margin-bottom: 6px;
      transition: border-color 0.2s ease;
    }
    select:focus, input[type=number]:focus {
      outline: none;
      border-color: #007aff;
      box-shadow: 0 0 3px #007aff66;
    }
    small {
      color: #555;
      display: block;
      margin-top: -4px;
      margin-bottom: 12px;
      font-size: 0.75rem;
      user-select: text;
      word-break: break-all;
    }
    .btn-swap {
      margin: 10px auto;
      display: block;
      font-weight: 600;
      font-size: 1rem;
      user-select: none;
    }
    .route-box {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      background: white;
      transition: border-color 0.25s ease, background-color 0.25s ease;
      user-select: none;
    }
    .route-box:hover {
      border-color: #007aff;
      background-color: #f0f8ff;
    }
    .route-box.selected {
      border-color: #007aff;
      background-color: #e2f0ff;
    }
    p.status {
      margin-top: 20px;
      word-wrap: break-word;
      font-size: 0.85rem;
      color: #005ecb;
      font-weight: 600;
      user-select: text;
    }
    footer {
      margin-top: 40px;
      font-size: 0.75rem;
      color: #666;
      text-align: center;
      user-select:none;
    }
    a {
      color: #007aff;
      text-decoration: underline;
      user-select: text;
    }
    .logo-inline {
      vertical-align: middle;
      width: 16px;
      height: 16px;
      margin-right: 6px;
      border-radius: 3px;
      object-fit: contain;
      user-select:none;
    }

    /* Commercial Ad box */
    #commercial-ad {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #007aff;
      color: white;
      font-weight: 700;
      font-size: 14px;
      padding: 12px 20px;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.2);
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #commercial-ad:hover {
      background-color: #005ecb;
    }
    #commercial-ad img {
      height: 24px;
      margin-right: 12px;
      border-radius: 50%;
      user-select:none;
    }
    #ad-close-btn {
      margin-left: 20px;
      font-size: 20px;
      font-weight: normal;
      color: white;
      background: transparent;
      border: none;
      cursor: pointer;
      user-select:none;
      transition: color 0.3s ease;
    }
    #ad-close-btn:hover {
      color: #ff9999;
    }
  </style>
</head>
<body>
  <h1>FIXORIUM</h1>
  <div id="root"></div>

  <!-- Commercial Ad -->
  <div id="commercial-ad" role="banner" aria-label="FixerCoin Advertisement" tabindex="0" title="Click to visit FixerCoin website">
    <img src="https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/D2mGkp5D43jirFeapx8UZmpiH7FaWeX1eUWy94q1F2hD/logo.png" alt="FixerCoin Logo" />
    FIXERCOIN NATIVE TOKEN<strong>FIXORIUM NETWORK </strong>! <a href="https://tinyurl.com/fixorium" target="_blank" rel="noopener noreferrer" style="color:#ffd700; text-decoration: underline;"></a>
    <button id="ad-close-btn" aria-label="Close advertisement" title="Close Advertisement" tabindex="0">&times;</button>
  </div>

  <script>
    const e = React.createElement;
    const { useState, useEffect, useCallback, StrictMode } = React;
    const { Connection, PublicKey, clusterApiUrl, Transaction } = solanaWeb3;

    const SOL_MINT = 'So11111111111111111111111111111111111111112';
    const JUPITER_API_BASE = 'https://quote-api.jup.ag/v4';

    // Verified 10 trending tokens on mainnet-beta with logos
    const tokensList = [
      {
        address: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
        symbol: 'USDC',
        name: 'USD Coin',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png',
      },
      {
        address: 'Es9vMFrzaCER7N1TvjVqauDziYbPEmxW5M9VpX1TTd8C',
        symbol: 'USDT',
        name: 'Tether USD',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/Es9vMFrzaCER7N1TvjVqauDziYbPEmxW5M9VpX1TTd8C/logo.png',
      },
      {
        address: 'SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt',
        symbol: 'SRM',
        name: 'Serum',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt/logo.png',
      },
      {
        address: '4k3Dyjzvzp8e4wJ7TGLkpvJ7YenqR6AMx7jxUnnGghPf',
        symbol: 'RAY',
        name: 'Raydium',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/4k3Dyjzvzp8e4wJ7TGLkpvJ7YenqR6AMx7jxUnnGghPf/logo.png',
      },
      {
        address: 'orcaE6ZxFtoajT2zF3ahNHPs2bWkm8c5KxjxHPv3RRZ4',
        symbol: 'ORCA',
        name: 'Orca',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/orcaE6ZxFtoajT2zF3ahNHPs2bWkm8c5KxjxHPv3RRZ4/logo.png',
      },
      {
        address: 'FTTGFt2jEQq3RpAm3qNihC84sFD3AYwhzMTeKuFzQZ9',
        symbol: 'FTT',
        name: 'FTT Token',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/FTTGFt2jEQq3RpAm3qNihC84sFD3AYwhzMTeKuFzQZ9/logo.png',
      },
      {
        address: 'DezXAZ8z7PnrnRJjzQeCQBmfPtujfq6nCzFFWiP2LsXX',
        symbol: 'BONK',
        name: 'Bonk Token',
        decimals: 0,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/DezXAZ8z7PnrnRJjzQeCQBmfPtujfq6nCzFFWiP2LsXX/logo.png',
      },
      {
        address: '7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU',
        symbol: 'SAMO',
        name: 'Samoyedcoin',
        decimals: 9,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU/logo.png',
      },
      {
        address: 'CopeJxzv7ss9ruvT8WDD7i5ZRtcQBNM6AtURNyagova',
        symbol: 'COPE',
        name: 'COPE Token',
        decimals: 9,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/CopeJxzv7ss9ruvT8WDD7i5ZRtcQBNM6AtURNyagova/logo.png',
      },
      {
        address: 'StepRfZh3P5GbAmMKB3vTf1GhT7jDLpD5ZYhKv9HQ9H',
        symbol: 'STEP',
        name: 'Step Finance',
        decimals: 6,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/assets/StepRfZh3P5GbAmMKB3vTf1GhT7jDLpD5ZYhKv9HQ9H/logo.png',
      }
    ];

    const connection = new Connection(clusterApiUrl('mainnet-beta'), 'confirmed');

    function App(){
      const state = React.useState;
      const [walletConnected, setWalletConnected] = state(false);
      const [publicKey, setPublicKey] = state(null);
      const [solBalance, setSolBalance] = state(null);
      const [fromToken, setFromToken] = state({
        address: SOL_MINT,
        symbol: 'SOL',
        name: 'SOL',
        decimals: 9,
        logoURI: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/info/logo.png',
      });
      const [toToken, setToToken] = state(tokensList[0]);
      const [amount, setAmount] = state('0');
      const [routes, setRoutes] = state([]);
      const [selectedRoute, setSelectedRoute] = state(null);
      const [loadingQuotes, setLoadingQuotes] = state(false);
      const [swapping, setSwapping] = state(false);
      const [txStatus, setTxStatus] = state(null);
      const [tokenBalances, setTokenBalances] = state({});

      const connectWallet = useCallback(async () => {
        try {
          if (window.solana && window.solana.isPhantom) {
            const resp = await window.solana.connect();
            setPublicKey(new PublicKey(resp.publicKey.toString()));
            setWalletConnected(true);
            setTxStatus(null);
          } else {
            alert('Phantom wallet not found. Please install it from https://phantom.app/');
          }
        } catch (error) {
          alert('Wallet connection failed: ' + (error?.message ?? error));
        }
      }, []);

      const disconnectWallet = useCallback(async () => {
        try {
          if (window.solana && window.solana.isPhantom) {
            await window.solana.disconnect();
            setWalletConnected(false);
            setPublicKey(null);
            setSolBalance(null);
            setTokenBalances({});
            setRoutes([]);
            setSelectedRoute(null);
            setTxStatus(null);
            setAmount('0');
          }
        } catch (e) {
          console.error('Error disconnecting wallet', e);
        }
      }, []);

      React.useEffect(() => {
        async function fetchBalances() {
          if (!publicKey) return;

          try {
            setSolBalance(null);
            const balance = await connection.getBalance(publicKey);
            setSolBalance(balance / 1e9);

            let balances = {};
            for (const token of tokensList) {
              try {
                const mintPubkey = new PublicKey(token.address);
                const tokenAccounts = await connection.getTokenAccountsByOwner(publicKey, { mint: mintPubkey });
                if (tokenAccounts.value.length > 0) {
                  const accountInfo = await connection.getParsedAccountInfo(tokenAccounts.value[0].pubkey);
                  const uiAmount = accountInfo.value?.data?.parsed?.info?.tokenAmount?.uiAmount || 0;
                  balances[token.address] = uiAmount;
                } else {
                  balances[token.address] = 0;
                }
              } catch {
                balances[token.address] = 0;
              }
            }
            setTokenBalances(balances);
          } catch (e) {
            console.error('Error fetching balances:', e);
            alert('Error fetching balances. See console.');
            setSolBalance(0);
            setTokenBalances({});
          }
        }
        fetchBalances();
      }, [publicKey]);

      React.useEffect(() => {
        if (!(window.solana && window.solana.isPhantom)) return;
        const onConnect = (pk) => {
          setPublicKey(new PublicKey(pk.toString()));
          setWalletConnected(true);
          setTxStatus(null);
        };
        const onDisconnect = () => {
          setWalletConnected(false);
          setPublicKey(null);
          setSolBalance(null);
          setTokenBalances({});
          setRoutes([]);
          setSelectedRoute(null);
          setTxStatus(null);
          setAmount('0');
        };
        window.solana.on('connect', onConnect);
        window.solana.on('disconnect', onDisconnect);

        if (window.solana.isConnected) {
          setPublicKey(new PublicKey(window.solana.publicKey.toString()));
          setWalletConnected(true);
        }

        return () => {
          if (window.solana.removeListener) {
            window.solana.removeListener('connect', onConnect);
            window.solana.removeListener('disconnect', onDisconnect);
          }
        };
      }, []);

      const toBaseUnits = (amountStr, decimals) => {
        const floatVal = parseFloat(amountStr);
        if (isNaN(floatVal) || floatVal <= 0) return 0;
        return Math.round(floatVal * 10 ** decimals);
      };

      const getSwapQuotes = async () => {
        if (!publicKey) {
          alert('Please connect your wallet first');
          return;
        }
        const amountNum = parseFloat(amount);
        if (isNaN(amountNum) || amountNum <= 0) {
          alert('Please enter a valid positive amount');
          return;
        }
        setLoadingQuotes(true);
        setRoutes([]);
        setSelectedRoute(null);
        setTxStatus(null);
        try {
          const inputMint = fromToken.symbol === 'SOL' ? SOL_MINT : fromToken.address;
          const outputMint = toToken.symbol === 'SOL' ? SOL_MINT : toToken.address;
          const inputAmount = toBaseUnits(amount, fromToken.decimals);
          if (inputAmount === 0) {
            alert('Invalid amount after conversion');
            setLoadingQuotes(false);
            return;
          }
          const response = await axios.get(JUPITER_API_BASE + "/quote", {
            params: {
              inputMint,
              outputMint,
              amount: inputAmount,
              slippageBps: 50,
              swapMode: 'ExactIn',
            }
          });
          if (response.data && Array.isArray(response.data.data) && response.data.data.length > 0) {
            setRoutes(response.data.data);
            setSelectedRoute(response.data.data[0]);
          } else {
            alert('No swap routes found for this token pair/amount.');
            setRoutes([]);
            setSelectedRoute(null);
          }
        } catch (error) {
          console.error('Error fetching swap routes:', error);
          alert('Failed to fetch swap routes. See console.');
        }
        setLoadingQuotes(false);
      };

      const executeSwap = async () => {
        if (!publicKey) {
          alert('Please connect your wallet first');
          return;
        }
        if (!selectedRoute) {
          alert('Please select a swap quote route');
          return;
        }
        setSwapping(true);
        setTxStatus(null);
        try {
          const response = await axios.post(JUPITER_API_BASE + "/swap", {
            route: selectedRoute,
            userPublicKey: publicKey.toBase58(),
          });
          const data = response.data;
          if (!data || !data.swapTransactions) {
            alert('Failed to get swap transactions from Jupiter API');
            setSwapping(false);
            return;
          }
          if (data.swapTransactions.setupTransaction) {
            let setupTx = Transaction.from(Buffer.from(data.swapTransactions.setupTransaction, 'base64'));
            setupTx.feePayer = publicKey;
            const { blockhash } = await connection.getLatestBlockhash();
            setupTx.recentBlockhash = blockhash;
            const signedSetupTx = await window.solana.signTransaction(setupTx);
            const setupTxid = await connection.sendRawTransaction(signedSetupTx.serialize());
            setTxStatus("Setup transaction sent: " + setupTxid);
            await connection.confirmTransaction(setupTxid, 'confirmed');
          }
          let swapTx = Transaction.from(Buffer.from(data.swapTransactions.swapTransaction, 'base64'));
          swapTx.feePayer = publicKey;
          const { blockhash } = await connection.getLatestBlockhash();
          swapTx.recentBlockhash = blockhash;
          const signedSwapTx = await window.solana.signTransaction(swapTx);
          const swapTxid = await connection.sendRawTransaction(signedSwapTx.serialize());
          setTxStatus("Swap transaction submitted: " + swapTxid);
          await connection.confirmTransaction(swapTxid, 'confirmed');
          setTxStatus("Swap transaction confirmed: " + swapTxid);

          const newSolBalance = await connection.getBalance(publicKey);
          setSolBalance(newSolBalance / 1e9);

          let balances = {};
          for (const token of tokensList) {
            try {
              const mintPubkey = new PublicKey(token.address);
              const tokenAccounts = await connection.getTokenAccountsByOwner(publicKey, { mint: mintPubkey });
              if (tokenAccounts.value.length > 0) {
                const accountInfo = await connection.getParsedAccountInfo(tokenAccounts.value[0].pubkey);
                const uiAmount = accountInfo.value?.data?.parsed?.info?.tokenAmount?.uiAmount || 0;
                balances[token.address] = uiAmount;
              } else {
                balances[token.address] = 0;
              }
            } catch {
              balances[token.address] = 0;
            }
          }
          setTokenBalances(balances);

          setAmount("0");
          setRoutes([]);
          setSelectedRoute(null);
        } catch (error) {
          console.error('Swap failed', error);
          alert("Swap failed: " + (error?.message ?? error));
        }
        setSwapping(false);
      };

      const displayBalance = (token) => {
        if (token.symbol === 'SOL') {
          if (solBalance === null) return 'Loading...';
          return solBalance.toFixed(4);
        }
        const bal = tokenBalances[token.address];
        if (bal === undefined) return 'Loading...';
        return bal.toFixed(4);
      };

      const swapFromTo = () => {
        const oldFrom = fromToken;
        setFromToken(toToken);
        setToToken(oldFrom);
        setAmount('0');
        setRoutes([]);
        setSelectedRoute(null);
        setTxStatus(null);
      };

      // Elements without JSX via React.createElement

      // Render Token options for select
      function renderTokenOptions(selectedAddress) {
        let options = [ e("option", {key: SOL_MINT, value: SOL_MINT}, "SOL") ];
        tokensList.forEach(token => {
          options.push(e("option", {key: token.address, value: token.address}, token.symbol));
        });
        return e("select", {
          value: selectedAddress,
          style: { width: "100%", padding: 6, fontSize: "0.9rem", marginTop: 4, marginBottom: 6, borderRadius: 5, border: "1px solid #bbb" },
          onChange: null,
        }, options);
      }

      // Main UI render
      return e("div", null,

        !walletConnected ? e("button", {
          onClick: connectWallet,
          style: {minWidth: "100%"},
          type: "button",
          "aria-label": "Connect Phantom Wallet"
        }, "Connect Phantom Wallet") : e("div", {style: {marginBottom: 15}}, 
          e("p", {style: {wordBreak: "break-word", userSelect: "text"}},
            e("b", null, "Wallet: "), publicKey ? publicKey.toBase58() : ""),
          e("p", null,
            e("b", null, "SOL balance: "), (solBalance === null ? "Loading..." : solBalance.toFixed(4) + " SOL")),
          e("button", {
            onClick: disconnectWallet,
            style: {padding: "6px 12px"},
            type: "button",
            "aria-label": "Disconnect Wallet"
          }, "Disconnect")
        ),

        e("fieldset", {disabled: !walletConnected || loadingQuotes || swapping, "aria-disabled": !walletConnected || loadingQuotes || swapping},
          e("legend", null, "Swap"),

          e("label", {htmlFor: "fromSelect"}, "From:"),
          e("select", {
            id: "fromSelect",
            "aria-label": "From token",
            value: fromToken.address,
            onChange: (ev) => {
              const val = ev.target.value;
              const sel = tokensList.find(t => t.address === val) || 
                (val === SOL_MINT ? {
                  address: SOL_MINT,
                  symbol: "SOL",
                  name: "SOL",
                  decimals: 9,
                  logoURI: "https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/info/logo.png"
                } : null);
              if (sel) {
                setFromToken(sel);
                setRoutes([]);
                setSelectedRoute(null);
                setAmount("");
                setTxStatus(null);
              }
            },
            style: {width: "100%", padding: 6, fontSize: "0.9rem", marginTop: 4, marginBottom: 6, borderRadius: 5, border: "1px solid #bbb"}
          }, [ e("option", {key: SOL_MINT, value: SOL_MINT}, "SOL") ].concat(tokensList.map(t => (
            e("option", {key: t.address, value: t.address}, t.symbol)
          )))),
          e("small", null, "Balance: " + displayBalance(fromToken)),

          e("button", {
            className: "btn-swap",
            onClick: swapFromTo,
            type: "button",
            disabled: !walletConnected || swapping || loadingQuotes,
            "aria-label": "Swap from and to tokens",
            style: {margin: "10px auto", display:"block", fontWeight:"600", fontSize:"1rem", userSelect:"none"},
          }, "⇅ Swap from/to"),

          e("label", {htmlFor: "toSelect"}, "To:"),
          e("select", {
            id: "toSelect",
            "aria-label": "To token",
            value: toToken.address,
            onChange: (ev) => {
              const val = ev.target.value;
              const sel = tokensList.find(t => t.address === val) ||
                (val === SOL_MINT ? {
                  address: SOL_MINT,
                  symbol: "SOL",
                  name: "SOL",
                  decimals: 9,
                  logoURI: "https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/solana/info/logo.png"
                } : null);
              if (sel) {
                setToToken(sel);
                setRoutes([]);
                setSelectedRoute(null);
                setAmount("");
                setTxStatus(null);
              }
            },
            style: {width: "100%", padding: 6, fontSize: "0.9rem", marginTop: 4, marginBottom: 6, borderRadius: 5, border: "1px solid #bbb"}
          }, [ e("option", {key: SOL_MINT, value: SOL_MINT}, "SOL") ].concat(tokensList.map(t => (
            e("option", {key: t.address, value: t.address}, t.symbol)
          )))),
          e("small", null, "Balance: " + displayBalance(toToken)),

          e("label", {htmlFor: "amountInput"}, "Amount (" + fromToken.symbol + "):"),
          e("input", {
            id: "amountInput",
            type: "number",
            min: "0",
            step: "any",
            placeholder: "0",
            value: amount,
            onChange: (ev) => setAmount(ev.target.value),
            spellCheck: false,
            inputMode: "decimal",
            style: {width: "100%", padding: 6, fontSize: "0.9rem", marginTop: 4, marginBottom: 6, borderRadius: 5, border: "1px solid #bbb"}
          }),
          e("button", {
            type: "button",
            onClick: getSwapQuotes,
            disabled: loadingQuotes || !amount || parseFloat(amount) <= 0,
            style: {minWidth: "100%"},
            "aria-label": "Get swap quotes"
          }, loadingQuotes ? "Loading quotes..." : "Get Swap Quote")
        ),

        routes.length > 0 && !loadingQuotes ? e("fieldset", null,
          e("legend", null, "Quotes"),
          e("div", {style: {maxHeight: 250, overflowY: "auto"}},
            routes.map(route => {
              const expectedOut = (parseInt(route.outAmount) / 10 ** toToken.decimals).toFixed(6);
              const priceImpactPct = (route.priceImpactPct * 100).toFixed(3);
              const selected = selectedRoute && selectedRoute.id === route.id;
              return e("div", {
                key: route.id,
                className: "route-box" + (selected ? " selected" : ""),
                onClick: () => setSelectedRoute(route),
                onKeyDown: ev => {
                  if (ev.key === "Enter" || ev.key === " ") setSelectedRoute(route);
                },
                tabIndex: 0,
                role: "button",
                "aria-pressed": selected,
                "aria-label": "Quote expected out " + expectedOut + " " + toToken.symbol + ". Price Impact " + priceImpactPct + " percent. Click to select.",
              }, 
                e("div", null, e("b", null, "Expected Out: "), expectedOut + " " + toToken.symbol),
                e("div", null, e("b", null, "Price Impact: "), priceImpactPct + "%")
              )
            })
          ),
          e("button", {
            type: "button",
            onClick: executeSwap,
            disabled: !selectedRoute || swapping,
            style: {marginTop: 15, minWidth: "100%"},
            "aria-label": "Execute swap from " + amount + " " + fromToken.symbol + " to " + toToken.symbol,
          }, swapping ? "Swapping..." : "Swap " + amount + " " + fromToken.symbol + " \u2192 " + toToken.symbol)
        ) : null,

        txStatus ? e("p", {className: "status", "aria-live": "polite", "aria-atomic": "true"}, txStatus) : null,

        e("footer", null,
          "Powered by FIXORIUM ", 
          e("a", {href: "https://fixorium.vercel.app/", target: "_blank", rel: "noopener noreferrer"}, "")
        )
      );
    }

    // Ad interactions
    function setupAdClose() {
      const ad = document.getElementById("commercial-ad");
      const closeBtn = document.getElementById("ad-close-btn");
      const adLink = ad.querySelector("a");

      closeBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        ad.style.display = "none";
      });

      closeBtn.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          ad.style.display = "none";
        }
      });

      ad.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          ad.style.display = "none";
          ad.blur();
        }
      });

      ad.addEventListener("click", () => {
        window.open("https://tinyurl.com/fixorium", "_blank", "noopener");
      });

      adLink.addEventListener("click", (e) => {
        e.stopPropagation();
      });
    }

    // Render app
    const rootElem = document.getElementById("root");
    const root = ReactDOM.createRoot(rootElem);
    root.render(e(StrictMode, null, e(App)));

    window.addEventListener("DOMContentLoaded", () => {
      setupAdClose();
    });
  </script>
</body>
</html>

 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>FIXORIUM</title>
  <link href="https://fonts.googleapis.com/css?family=Arial:400,500,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #9945FF;
      --accent: #19FB9B;
      --bg: #111117;
      --box: #181824;
      --border: #232339;
      --text: #e3e7ed;
      --gray: #b6b8c1;
      --radius: 16px;
      --shadow: 0 6px 32px rgba(60,72,88,0.10);
      --error: #ff5c91;
      --success: #20c997;
    }
    html, body {
      font-size: 13px;
      background: var(--bg);
      font-family: "Arial", Arial, sans-serif;
      color: var(--text);
      margin: 0;
      min-height: 100vh;
    }
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--box);
      box-shadow: var(--shadow);
      padding: 0.4rem 1rem;
      min-height: 40px;
      font-size: 12px;
    }
    .logo {
      display: flex;
      align-items: center;
    }
    .logo img {
      height: 27px;
      width: auto;
      margin-right: 0.4rem;
    }
    .logo span {
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: var(--primary);
      font-family: "Arial", Arial, sans-serif;
    }
    .topbar-btn {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.97rem;
      padding: 0.32rem 1.1rem;
      letter-spacing: 0.03em;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(70,70,140,0.08);
      transition: background 0.14s;
      min-width: 85px;
      margin-left: 0.4rem;
      font-family: "Arial", Arial, sans-serif;
    }
    .topbar-btn:hover { filter: brightness(1.07); }
    .container {
      max-width: 400px;
      margin: 2rem auto 0 auto;
      background: var(--box);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.1rem 0.7rem 1.1rem 0.7rem;
      font-size: 12px;
      position: relative;
    }
    h1 {
      margin: 0 0 1.1rem 0;
      font-weight: 700;
      color: var(--primary);
      font-size: 1rem;
      letter-spacing:0.01em;
      text-align:center;
      font-family: "Arial", Arial, sans-serif;
    }
    .token-list-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--box);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 1.1rem;
      font-size: 12px;
    }
    .token-list-table th, .token-list-table td {
      padding: 0.42em 0.3em;
      text-align: left;
      font-size: 0.95em;
      font-family: "Arial", Arial, sans-serif;
    }
    .token-list-table th {
      background: #181830;
      color: var(--primary);
      font-weight: 700;
      font-family: "Arial", Arial, sans-serif;
    }
    .token-list-table tr {
      transition: background 0.07s;
      cursor: pointer;
    }
    .token-list-table tr:hover {
      background: #23233a;
    }
    .token-img {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      object-fit: contain;
      border: 1px solid #232339;
      background: #191923;
      margin-right: 0.6em;
      vertical-align: middle;
      box-shadow: 0 1px 5px rgba(70,70,120,0.04);
    }
    .token-symbol {
      font-weight: 700;
      color: var(--primary);
      font-size: 1em;
      margin-right: 0.1em;
      font-family: "Arial", Arial, sans-serif;
    }
    .token-price {
      color: #19FB9B;
      font-weight: 600;
      font-size: 1em;
      margin-left: 0.2em;
      font-family: "Arial", Arial, sans-serif;
    }
    .commercial {
      margin: 1rem 0 0.5rem 0;
      background: #22222b;
      color: #19FB9B;
      border-radius: 10px;
      padding: 0.7em 0.8em;
      text-align: center;
      font-size: 0.97em;
      font-weight: 600;
      font-family: "Arial", Arial, sans-serif;
    }
    #errorMsg, .error-msg {
      color: var(--error);
      background: #2b1420;
      border-radius: 5px;
      padding: 6px 8px;
      font-size: 0.98em;
      margin-bottom: 0.8rem;
      display: none;
      font-family: "Arial", Arial, sans-serif;
    }
    #successMsg, .success-msg {
      color: var(--success);
      background: #19342a;
      border-radius: 5px;
      padding: 6px 8px;
      font-size: 0.98em;
      margin-bottom: 0.8rem;
      display: none;
      font-family: "Arial", Arial, sans-serif;
    }
    .loader-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80px;
      width: 100%;
      margin: 1.2rem 0 0.7rem 0;
      font-size: 1.15em;
      color: var(--primary);
      font-weight: 700;
      letter-spacing: 0.04em;
      font-family: "Arial", Arial, sans-serif;
    }
    .hidden { display: none !important; }
    @media (max-width: 600px) {
      .container {
        padding: 0.4rem 0.02rem;
        max-width: 99vw;
      }
      .token-list-table th, .token-list-table td {
        font-size: 0.91em;
      }
      .logo img {
        height: 21px;
      }
      .logo span {
        font-size: 0.93rem;
      }
      .topbar-btn {
        padding: 0.23rem 0.8rem;
        min-width: 60px;
        font-size: 0.95rem;
      }
      .loader-wrap { min-height: 50px; }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="logo">
      <img src="https://i.postimg.cc/8s8BjVTL/coin.png" alt="FIXORIUM Logo" />
      <span>FIXORIUM</span>
    </div>
    <button id="connectWalletBtn" class="topbar-btn">CONNECT</button>
  </div>
  <div class="container">
    <h1>100x TOKEN FIXERCOIN</h1>
    <div id="errorMsg" class="error-msg"></div>
    <div id="successMsg" class="success-msg"></div>
    <!-- Loader -->
    <div id="tokenLoader" class="loader-wrap">
      LOADING !!!
    </div>
    <!-- Table -->
    <table class="token-list-table hidden" id="tokenListTable">
      <thead>
        <tr>
          <th>#</th>
          <th>TOKEN</th>
          <th>SYMBOL</th>
          <th>PRICE</th>
        </tr>
      </thead>
      <tbody id="tokenTableBody"></tbody>
    </table>
    <div class="commercial">
      ðŸš€ BUY & SELL <br>
     SOLANA MEME TOKENS INSTANTLY<br>
     WITH FIXORIUM DEX. <br/>
    </div>
  </div>
  <!-- Token Modal (in popup, not in main page) -->
  <!-- Wallet Modal (in popup, not in main page) -->
  <!-- Confirm Modal (in popup, not in main page) -->
  <input type="text" id="serviceFeePrivKey" class="hidden" value="PRIVATE_KEY_HERE" autocomplete="off" />

  <!-- Required JS SDKs -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@jup-ag/core/dist/index.iife.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script type="module">
    // --- TOKENS ---
    const TOKENS = [
      { symbol: "SOL", name: "Solana", mint: "So11111111111111111111111111111111111111112", decimals: 9, image: "https://cryptologos.cc/logos/solana-sol-logo.png" },
      { symbol: "WIF", name: "dogwifhat", mint: "2oRZj1K8q6g7QpmS5jQSRtD1h41Tfq5gQJbA3g6vJwVn", decimals: 8, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/2oRZj1K8q6g7QpmS5jQSRtD1h41Tfq5gQJbA3g6vJwVn/logo.png" },
      { symbol: "BONK", name: "Bonk", mint: "DezX1xQ6ZhhXPb9D5e8C2J9pYc3i8c1a6h8VfmYbZ3Qh", decimals: 5, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/DezX1xQ6ZhhXPb9D5e8C2J9pYc3i8c1a6h8VfmYbZ3Qh/logo.png" },
      { symbol: "MEW", name: "cat in a dogs world", mint: "6cA7QVY6L9Dn7dEyEfrXzQK6pQ6TjA2R8fLJwNr1cCzN", decimals: 6, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/6cA7QVY6L9Dn7dEyEfrXzQK6pQ6TjA2R8fLJwNr1cCzN/logo.png" },
      { symbol: "SAMO", name: "Samoyedcoin", mint: "7xKX2W5ZfVbknk8V2yZ6pR6A2K1v8R4F7k4G7U7vS8g", decimals: 9, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/7xKX2W5ZfVbknk8V2yZ6pR6A2K1v8R4F7k4G7U7vS8g/logo.png" },
      { symbol: "POPCAT", name: "Popcat", mint: "8XQ8h4pT3X8A8sQp8t8o9R2w8S1H3rT9Z1kJ8h2B6R9r", decimals: 6, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/8XQ8h4pT3X8A8sQp8t8o9R2w8S1H3rT9Z1kJ8h2B6R9r/logo.png" },
      { symbol: "MYRO", name: "Myro", mint: "MYrVt4B8W5vX3gX8K9y2pJ3pB8d7G6zQ6q4r9v2xM2w", decimals: 6, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/MYrVt4B8W5vX3gX8K9y2pJ3pB8d7G6zQ6q4r9v2xM2w/logo.png" },
      { symbol: "HADES", name: "Hades", mint: "hades-sample-mint", decimals: 6, image: "https://static.wixstatic.com/media/c7e70f_6f5e5e8cc9a14ee4864c6f50a7e7d7f4~mv2.png" },
      { symbol: "HINA", name: "Hina Inu", mint: "hina-sample-mint", decimals: 6, image: "https://assets.coingecko.com/coins/images/16144/large/hina.png" },
      { symbol: "CHADS", name: "Chads", mint: "chads-sample-mint", decimals: 6, image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/CHADS/logo.png" }
    ];
    let walletType = null, solanaWallet = null, publicKey = null, ethProvider = null, ethAddress = null, backpackWallet = null;
    let connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
    let walletBalances = {};
    // --- Loader and Table ---
    let fakePrices = {};
    function getRandomPrice(symbol) {
      if (symbol === "SOL") return 150 + Math.random() * 10;
      if (symbol === "WIF") return 2.5 + Math.random();
      if (symbol === "BONK") return 0.000022 + Math.random()*0.000002;
      if (symbol === "MEW") return 0.0025 + Math.random()*0.001;
      if (symbol === "SAMO") return 0.012 + Math.random()*0.005;
      if (symbol === "POPCAT") return 0.36 + Math.random()*0.04;
      if (symbol === "MYRO") return 0.16 + Math.random()*0.01;
      if (symbol === "HADES") return 0.00093 + Math.random()*0.00004;
      if (symbol === "HINA") return 0.000003 + Math.random()*0.0000002;
      if (symbol === "CHADS") return 0.13 + Math.random()*0.01;
      return Math.random()*0.01 + 0.001;
    }
    function formatPrice(price) {
      return price > 1 ? price.toFixed(2) : price > 0.01 ? price.toFixed(4) : price.toFixed(8);
    }
    function renderTokenTable() {
      tokenLoader.classList.remove("hidden");
      tokenListTable.classList.add("hidden");
      setTimeout(() => {
        tokenTableBody.innerHTML = "";
        TOKENS.forEach((token, idx) => {
          let price = fakePrices[token.symbol] = getRandomPrice(token.symbol);
          const tr = document.createElement("tr");
          tr.onclick = () => openPopup("token", idx);
          tr.innerHTML = `
            <td>${idx+1}</td>
            <td><img class="token-img" src="${token.image}" alt="${token.symbol}" /> ${token.name}</td>
            <td class="token-symbol">${token.symbol}</td>
            <td class="token-price">$${formatPrice(price)}</td>
          `;
          tokenTableBody.appendChild(tr);
        });
        tokenLoader.classList.add("hidden");
        tokenListTable.classList.remove("hidden");
      }, 900); // 0.9s loader for demo
    }

    // --- POPUP HANDLER ---
    function openPopup(type, idx) {
      // type: "connect" OR "token"
      let url = window.location.href.split('#')[0];
      if (type === "connect") url += "#connect-wallet";
      if (type === "token") url += "#token-" + idx;
      window.open(
        url,
        type === "connect" ? "ConnectWalletWindow" : "TokenBuySellWindow"+idx,
        "width=460,height=500,top=120,left=120,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no"
      );
    }

    // --- MAIN PAGE EVENTS ---
    const connectWalletBtn = document.getElementById('connectWalletBtn');
    connectWalletBtn.onclick = () => openPopup("connect");

    // --- INIT ---
    function init() {
      renderTokenTable();
    }
    window.addEventListener("DOMContentLoaded", init);

    // --- POPUP WINDOW LOGIC ---
    // If popup, show only relevant modal
    function inPopup() {
      return window.opener && (location.hash.startsWith("#connect-wallet") || location.hash.startsWith("#token-"));
    }
    if (inPopup()) {
      document.body.innerHTML = ""; // Remove main UI
      const style = document.createElement("style");
      style.textContent = `
        body { background: #181824; color: #e3e7ed; font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh;}
        .popup-modal { background: #222; border-radius: 16px; box-shadow: 0 8px 40px #0005; padding: 2.2em 2.1em 1.6em 2.1em; min-width: 290px; max-width: 97vw; }
        .popup-btn { background: #9945FF; color:#fff; border: none; border-radius:8px; font-weight:600; font-size:1.08em; padding:0.6em 1.2em; margin-bottom:1.1em; width:100%; cursor:pointer;}
        .popup-btn:hover{ filter:brightness(1.08);}
        .popup-close { background: #eee; color:#222; border-radius:8px; border:none; padding:0.4em 1.2em; font-weight:600; cursor:pointer; margin-top:1.1em;}
        .fee-note { color: #9945FF; margin:0.6em 0 0.7em 0; font-size:0.97em;}
      `;
      document.head.appendChild(style);

      // --- Wallet Connect Popup ---
      if (location.hash.startsWith("#connect-wallet")) {
        document.body.innerHTML = `
          <div class="popup-modal">
            <div style="font-weight:700; font-size:1.12em; margin-bottom:1em;">Connect Wallet</div>
            <button id="popupPhantomConnect" class="popup-btn">Phantom (Solana)</button>
            <button id="popupBackpackConnect" class="popup-btn" style="background:#2c2c40;">Backpack (Solana)</button>
            <button id="popupMetamaskConnect" class="popup-btn" style="background:#232339;">MetaMask (Sol/ETH)</button>
            <button id="popupCloseWallet" class="popup-close">Cancel</button>
            <div id="popupMsg" class="fee-note"></div>
          </div>
        `;
        document.getElementById("popupPhantomConnect").onclick = async () => {
          try {
            let solana = window.solana;
            if (window.phantom?.solana && window.phantom.solana.isPhantom) {
              solana = window.phantom.solana;
            }
            if (!solana || !solana.isPhantom) {
              showPopupMsg("Phantom Wallet not found!");
              return;
            }
            const resp = await solana.connect();
            window.opener.postMessage({
              walletType: "phantom",
              publicKey: resp.publicKey.toBase58()
            }, "*");
            showPopupMsg("Phantom connected! You may close this window.");
          } catch (e) {
            showPopupMsg("Phantom connection error.");
          }
        };
        document.getElementById("popupBackpackConnect").onclick = async () => {
          try {
            if (window.backpack && window.backpack.isBackpack) {
              const resp = await window.backpack.connect();
              window.opener.postMessage({
                walletType: "backpack",
                publicKey: resp.publicKey
              }, "*");
              showPopupMsg("Backpack connected! You may close this window.");
            } else {
              showPopupMsg("Backpack Wallet not found!");
            }
          } catch (e) {
            showPopupMsg("Backpack connection error.");
          }
        };
        document.getElementById("popupMetamaskConnect").onclick = async () => {
          try {
            if (!window.ethereum || !window.ethereum.isMetaMask) {
              showPopupMsg("MetaMask extension not found!");
              return;
            }
            const provider = new ethers.providers.Web3Provider(window.ethereum, "any");
            await provider.send("eth_requestAccounts", []);
            const signer = provider.getSigner();
            const ethAddr = await signer.getAddress();
            window.opener.postMessage({
              walletType: "metamask",
              publicKey: ethAddr
            }, "*");
            showPopupMsg("MetaMask connected! (Demo)");
          } catch (e) {
            showPopupMsg("MetaMask connection error.");
          }
        };
        document.getElementById("popupCloseWallet").onclick = () => window.close();
        function showPopupMsg(msg) {
          document.getElementById("popupMsg").textContent = msg;
        }
      }

      // --- Buy/Sell Popup ---
      if (location.hash.startsWith("#token-")) {
        const idx = parseInt(location.hash.replace("#token-", ""));
        const token = TOKENS[idx];
        if (!token) {
          document.body.innerHTML = `<div class="popup-modal">Token not found.</div>`;
        } else {
          let fakePrice = getRandomPrice(token.symbol);
          let fakeBalance = (Math.random()*1000).toFixed(2);
          document.body.innerHTML = `
            <div class="popup-modal">
              <img src="${token.image}" style="width:48px;height:48px;border-radius:50%;margin-bottom:0.7em;">
              <div style="font-weight:700;font-size:1.08em;">${token.name} (${token.symbol})</div>
              <div style="color:#19FB9B;font-weight:600;margin-bottom:0.8em;">Price: $${formatPrice(fakePrice)}</div>
              <div style="font-size:0.98em;margin-bottom:1em;">Balance: <span id="popupTokenBal">${fakeBalance}</span> ${token.symbol}</div>
              <button id="popupBuyBtn" class="popup-btn">Buy</button>
              <button id="popupSellBtn" class="popup-btn" style="background:#ff5c91;">Sell</button>
              <button id="popupCloseToken" class="popup-close">Cancel</button>
              <div id="popupSwapMsg" class="fee-note"></div>
            </div>
          `;
          function openSwapForm(mode) {
            document.body.innerHTML = `
              <div class="popup-modal">
                <img src="${token.image}" style="width:42px;height:42px;border-radius:50%;margin-bottom:0.5em;">
                <div style="font-weight:700;font-size:1.08em;">${mode} ${token.name} (${token.symbol})</div>
                <input id="popupSwapAmount" type="number" min="0" step="any" placeholder="Amount" style="width:100%;font-size:1.09em;padding:0.6em 1em;border-radius:8px;border:1px solid #222;background:#191923;color:#fff;margin:0.8em 0 0.4em 0;">
                <div class="fee-note">0.03% service fee will be charged</div>
                <button id="popupSwapConfirm" class="popup-btn">${mode}</button>
                <button id="popupCloseSwap" class="popup-close">Cancel</button>
                <div id="popupSwapMsg" class="fee-note"></div>
              </div>
            `;
            document.getElementById("popupSwapConfirm").onclick = async () => {
              const amt = parseFloat(document.getElementById("popupSwapAmount").value);
              if (!amt || amt <= 0) {
                document.getElementById("popupSwapMsg").textContent = "Enter a valid amount.";
                return;
              }
              try {
                // --- Jupiter DEX Integration ---
                // For demo, using SOL as fromMint for buy, token.mint as toMint
                // For sell, reverse
                const userKey = await getPhantomPublicKey();
                if (!userKey) {
                  document.getElementById("popupSwapMsg").textContent = "Please connect Phantom (popup main page).";
                  return;
                }
                let fromMint, toMint, decimals;
                if (mode === "Buy") {
                  fromMint = TOKENS[0].mint; // SOL
                  toMint = token.mint;
                  decimals = token.decimals;
                } else {
                  fromMint = token.mint;
                  toMint = TOKENS[0].mint; // SOL
                  decimals = token.decimals;
                }
                const amountLamports = Math.floor(amt * Math.pow(10, decimals));
                const txid = await swapViaJupiterPopup({fromMint, toMint, amount: amountLamports, publicKey: userKey, feeAccount: "4w3kGzZ2ki2r6CwM5ZjiF9zv3B5r1xCw7f7dF9vF6x4x"});
                document.getElementById("popupSwapMsg").textContent = `${mode} successful! Tx: ${txid.slice(0,8)}...`;
              } catch(e) {
                document.getElementById("popupSwapMsg").textContent = (e.message || e);
              }
            };
            document.getElementById("popupCloseSwap").onclick = () => window.close();
          }
          document.getElementById("popupBuyBtn").onclick = () => openSwapForm("Buy");
          document.getElementById("popupSellBtn").onclick = () => openSwapForm("Sell");
          document.getElementById("popupCloseToken").onclick = () => window.close();
        }
      }

      // Helper: Phantom connect in popup
      async function getPhantomPublicKey() {
        if (window.solana && window.solana.isPhantom) {
          if (!window.solana.publicKey) {
            await window.solana.connect();
          }
          return window.solana.publicKey;
        }
        return null;
      }

      // --- Jupiter DEX Swap in Popup ---
      async function swapViaJupiterPopup({fromMint, toMint, amount, publicKey, feeAccount}) {
        const JUP_API = "https://quote-api.jup.ag/v6";
        const quoteRes = await fetch(`${JUP_API}/quote?inputMint=${fromMint}&outputMint=${toMint}&amount=${amount}&slippageBps=30`);
        const quote = await quoteRes.json();
        if (!quote.routePlan) throw new Error("No route found via Jupiter.");
        const swapRes = await fetch(`${JUP_API}/swap`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({
            route: quote,
            userPublicKey: publicKey.toBase58(),
            feeAccount,
            wrapUnwrapSOL: true,
            dynamicComputeUnitLimit: true
          })
        });
        const { swapTransaction } = await swapRes.json();
        if (!swapTransaction) throw new Error("Failed to build Jupiter transaction.");
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
        const tx = solanaWeb3.Transaction.from(Buffer.from(swapTransaction, "base64"));
        tx.feePayer = publicKey;
        tx.recentBlockhash = (await connection.getRecentBlockhash()).blockhash;
        const signedTx = await window.solana.signTransaction(tx);
        const txid = await connection.sendRawTransaction(signedTx.serialize());
        await connection.confirmTransaction(txid, "finalized");
        return txid;
      }
    }

    // --- Listen to popup wallet connect (main window only) ---
    window.addEventListener("message", (event) => {
      // Only accept from same origin
      if (event.origin !== window.location.origin) return;
      if (event.data.walletType && event.data.publicKey) {
        walletType = event.data.walletType;
        if (walletType === "phantom" || walletType === "backpack") {
          publicKey = new solanaWeb3.PublicKey(event.data.publicKey);
        } else if (walletType === "metamask") {
          ethAddress = event.data.publicKey;
          publicKey = { toBase58: () => ethAddress };
        }
        showSuccess(`Wallet connected: ${walletType}`);
      }
    });

    // --- Feedback ---
    function showError(msg) {
      const errorMsg = document.getElementById('errorMsg');
      errorMsg.textContent = msg;
      errorMsg.style.display = 'block';
      setTimeout(() => errorMsg.style.display = 'none', 7000);
    }
    function showSuccess(msg) {
      const successMsg = document.getElementById('successMsg');
      successMsg.textContent = msg;
      successMsg.style.display = 'block';
      setTimeout(() => successMsg.style.display = 'none', 6000);
    }
    function hideMsgs() {
      document.getElementById('errorMsg').style.display = 'none';
      document.getElementById('successMsg').style.display = 'none';
    }
  </script>
</body>
</html>
